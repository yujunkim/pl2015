<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<link href="coqdoc.css" rel="stylesheet" type="text/css"/>
<title>Sub</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library Sub</h1>

<div class="code">
</div>

<div class="doc">
<a name="lab765"></a><h1 class="section">Sub: Subtyping</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Export</span> <span class="id" type="keyword">Types</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab766"></a><h1 class="section">Concepts</h1>

<div class="paragraph"> </div>

 We now turn to the study of <i>subtyping</i>, perhaps the most
    characteristic feature of the static type systems of recently
    designed programming languages and a key feature needed to support
    the object-oriented programming style. 
</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a name="lab767"></a><h2 class="section">A Motivating Example</h2>

<div class="paragraph"> </div>

 Suppose we are writing a program involving two record types
    defined as follows:
<pre>
    Person  = {name:String, age:Nat}
    Student = {name:String, age:Nat, gpa:Nat}
</pre>

<div class="paragraph"> </div>

 In the simply typed lamdba-calculus with records, the term
<pre>
    (\r:Person. (r.age)+1) {name="Pat",age=21,gpa=1}
</pre>
   is not typable: it involves an application of a function that wants
   a one-field record to an argument that actually provides two
   fields, while the <span class="inlinecode"><a class="idref" href="Norm.html#T_App"><span class="id" type="constructor">T_App</span></a></span> rule demands that the domain type of the
   function being applied must match the type of the argument
   precisely.  

<div class="paragraph"> </div>

   But this is silly: we're passing the function a <i>better</i> argument
   than it needs!  The only thing the body of the function can
   possibly do with its record argument <span class="inlinecode"><a class="idref" href="References.html#STLCRef.ExampleVariables.r"><span class="id" type="definition">r</span></a></span> is project the field <span class="inlinecode"><span class="id" type="var">age</span></span>
   from it: nothing else is allowed by the type, and the presence or
   absence of an extra <span class="inlinecode"><span class="id" type="var">gpa</span></span> field makes no difference at all.  So,
   intuitively, it seems that this function should be applicable to
   any record value that has at least an <span class="inlinecode"><span class="id" type="var">age</span></span> field.

<div class="paragraph"> </div>

   Looking at the same thing from another point of view, a record with
   more fields is "at least as good in any context" as one with just a
   subset of these fields, in the sense that any value belonging to
   the longer record type can be used <i>safely</i> in any context
   expecting the shorter record type.  If the context expects
   something with the shorter type but we actually give it something
   with the longer type, nothing bad will happen (formally, the
   program will not get stuck).

<div class="paragraph"> </div>

   The general principle at work here is called <i>subtyping</i>.  We say
   that "<span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a></span> is a subtype of <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span>", informally written <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a></span> <span class="inlinecode">&lt;:</span> <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span>, if a
   value of type <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a></span> can safely be used in any context where a value
   of type <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> is expected.  The idea of subtyping applies not only to
   records, but to all of the type constructors in the language --
   functions, pairs, etc. 
<div class="paragraph"> </div>

<a name="lab768"></a><h2 class="section">Subtyping and Object-Oriented Languages</h2>

<div class="paragraph"> </div>

 Subtyping plays a fundamental role in many programming
    languages -- in particular, it is closely related to the notion of
    <i>subclassing</i> in object-oriented languages.

<div class="paragraph"> </div>

    An <i>object</i> in Java, C<span class="inlinecode">#</span>, etc. can be thought of as a record,
    some of whose fields are functions ("methods") and some of whose
    fields are data values ("fields" or "instance variables").
    Invoking a method <span class="inlinecode"><a class="idref" href="MoreStlc.html#STLCExtended.Examples.m"><span class="id" type="abbreviation">m</span></a></span> of an object <span class="inlinecode"><a class="idref" href="Basics.html#o"><span class="id" type="variable">o</span></a></span> on some arguments <span class="inlinecode"><a class="idref" href="Imp.html#a1"><span class="id" type="variable">a1</span></a>..<span class="id" type="var">an</span></span>
    consists of projecting out the <span class="inlinecode"><a class="idref" href="MoreStlc.html#STLCExtended.Examples.m"><span class="id" type="abbreviation">m</span></a></span> field of <span class="inlinecode"><a class="idref" href="Basics.html#o"><span class="id" type="variable">o</span></a></span> and applying it to
    <span class="inlinecode"><a class="idref" href="Imp.html#a1"><span class="id" type="variable">a1</span></a>..<span class="id" type="var">an</span></span>.

<div class="paragraph"> </div>

    The type of an object can be given as either a <i>class</i> or an
    <i>interface</i>.  Both of these provide a description of which methods
    and which data fields the object offers.

<div class="paragraph"> </div>

    Classes and interfaces are related by the <i>subclass</i> and
    <i>subinterface</i> relations.  An object belonging to a subclass (or
    subinterface) is required to provide all the methods and fields of
    one belonging to a superclass (or superinterface), plus possibly
    some more.

<div class="paragraph"> </div>

    The fact that an object from a subclass (or sub-interface) can be
    used in place of one from a superclass (or super-interface)
    provides a degree of flexibility that is is extremely handy for
    organizing complex libraries.  For example, a GUI toolkit like
    Java's Swing framework might define an abstract interface
    <span class="inlinecode"><span class="id" type="var">Component</span></span> that collects together the common fields and methods
    of all objects having a graphical representation that can be
    displayed on the screen and that can interact with the user.
    Examples of such object would include the buttons, checkboxes, and
    scrollbars of a typical GUI.  A method that relies only on this
    common interface can now be applied to any of these objects.

<div class="paragraph"> </div>

    Of course, real object-oriented languages include many other
    features besides these.  For example, fields can be updated.
    Fields and methods can be declared <span class="inlinecode"><span class="id" type="var">private</span></span>.  Classes also give
    <i>code</i> that is used when constructing objects and implementing
    their methods, and the code in subclasses cooperate with code in
    superclasses via <i>inheritance</i>.  Classes can have static methods
    and fields, initializers, etc., etc.

<div class="paragraph"> </div>

    To keep things simple here, we won't deal with any of these
    issues -- in fact, we won't even talk any more about objects or
    classes.  (There is a lot of discussion in <i>Types and Programming
    Languages</i>, if you are interested.)  Instead, we'll study the core
    concepts behind the subclass / subinterface relation in the
    simplified setting of the STLC. 
<div class="paragraph"> </div>

<a name="lab769"></a><h3 class="section"> </h3>
 Of course, real OO languages have lots of other features...

<div class="paragraph"> </div>

<ul class="doclist">
<li> mutable fields

</li>
<li> <span class="inlinecode"><span class="id" type="var">private</span></span> and other visibility modifiers

</li>
<li> method inheritance

</li>
<li> static components

</li>
<li> etc., etc.

</li>
</ul>

<div class="paragraph"> </div>

    We'll ignore all these and focus on core mechanisms. 
<div class="paragraph"> </div>

<a name="lab770"></a><h2 class="section">The Subsumption Rule</h2>

<div class="paragraph"> </div>

 Our goal for this chapter is to add subtyping to the simply typed
    lambda-calculus (with some of the basic extensions from <span class="inlinecode"><span class="id" type="library">MoreStlc</span></span>).
    This involves two steps:

<div class="paragraph"> </div>

<ul class="doclist">
<li> Defining a binary <i>subtype relation</i> between types.

<div class="paragraph"> </div>


</li>
<li> Enriching the typing relation to take subtyping into account.

</li>
</ul>

<div class="paragraph"> </div>

    The second step is actually very simple.  We add just a single rule
    to the typing relation: the so-called <i>rule of subsumption</i>:
                         Gamma |- t : S     S &lt;: T
<hr/>
                      (T_Sub)
                               Gamma |- t : T
    This rule says, intuitively, that it is OK to "forget" some of
    what we know about a term.  For example, we may know that <span class="inlinecode"><a class="idref" href="ImpParser.html#t"><span class="id" type="variable">t</span></a></span> is a record with two
    fields (e.g., <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a></span> <span class="inlinecode">=</span> <span class="inlinecode">{<a class="idref" href="RecordSub.html#Examples.x"><span class="id" type="abbreviation">x</span></a>:<a class="idref" href="RecordSub.html#Examples.A"><span class="id" type="abbreviation">A</span></a>→<a class="idref" href="RecordSub.html#Examples.A"><span class="id" type="abbreviation">A</span></a>,</span> <span class="inlinecode"><a class="idref" href="RecordSub.html#Examples.y"><span class="id" type="abbreviation">y</span></a>:<a class="idref" href="RecordSub.html#Examples.B"><span class="id" type="abbreviation">B</span></a>→<a class="idref" href="RecordSub.html#Examples.B"><span class="id" type="abbreviation">B</span></a>}</span>), but choose to forget about
    one of the fields (<span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> <span class="inlinecode">=</span> <span class="inlinecode">{<a class="idref" href="RecordSub.html#Examples.y"><span class="id" type="abbreviation">y</span></a>:<a class="idref" href="RecordSub.html#Examples.B"><span class="id" type="abbreviation">B</span></a>→<a class="idref" href="RecordSub.html#Examples.B"><span class="id" type="abbreviation">B</span></a>}</span>) so that we can pass <span class="inlinecode"><a class="idref" href="ImpParser.html#t"><span class="id" type="variable">t</span></a></span> to a
    function that requires just a single-field record. 
<div class="paragraph"> </div>

<a name="lab771"></a><h2 class="section">The Subtype Relation</h2>

<div class="paragraph"> </div>

 The first step -- the definition of the relation <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a></span> <span class="inlinecode">&lt;:</span> <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> -- is
    where all the action is.  Let's look at each of the clauses of its
    definition.  
<div class="paragraph"> </div>

<a name="lab772"></a><h3 class="section">Structural Rules</h3>

<div class="paragraph"> </div>

 To start off, we impose two "structural rules" that are
    independent of any particular type constructor: a rule of
    <i>transitivity</i>, which says intuitively that, if <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a></span> is better than
    <span class="inlinecode"><a class="idref" href="Auto.html#U"><span class="id" type="variable">U</span></a></span> and <span class="inlinecode"><a class="idref" href="Auto.html#U"><span class="id" type="variable">U</span></a></span> is better than <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span>, then <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a></span> is better than <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span>...
                              S &lt;: U    U &lt;: T
<hr/>
                        (S_Trans)
                                   S &lt;: T
    ... and a rule of <i>reflexivity</i>, since certainly any type <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> is 
    as good as itself:  
<hr/>
                              (S_Refl)
                                   T &lt;: T

<div class="paragraph"> </div>

<a name="lab773"></a><h3 class="section">Products</h3>

<div class="paragraph"> </div>

 Now we consider the individual type constructors, one by one,
    beginning with product types.  We consider one pair to be "better
    than" another if each of its components is.
                            S1 &lt;: T1    S2 &lt;: T2
<hr/>
                        (S_Prod)
                             S1 * S2 &lt;: T1 * T2

<div class="paragraph"> </div>

<a name="lab774"></a><h3 class="section">Arrows</h3>

<div class="paragraph"> </div>

 Suppose we have two functions <span class="inlinecode"><a class="idref" href="Records.html#STLCExtendedRecords.f"><span class="id" type="abbreviation">f</span></a></span> and <span class="inlinecode"><a class="idref" href="Records.html#STLCExtendedRecords.g"><span class="id" type="abbreviation">g</span></a></span> with these types:
       f : C -&gt; Student 
       g : (C-&gt;Person) -&gt; D
    That is, <span class="inlinecode"><a class="idref" href="Records.html#STLCExtendedRecords.f"><span class="id" type="abbreviation">f</span></a></span> is a function that yields a record of type <span class="inlinecode"><a class="idref" href="Sub.html#Examples.Student"><span class="id" type="definition">Student</span></a></span>,
    and <span class="inlinecode"><a class="idref" href="Records.html#STLCExtendedRecords.g"><span class="id" type="abbreviation">g</span></a></span> is a (higher-order) function that expects its (function)
    argument to yield a record of type <span class="inlinecode"><a class="idref" href="Sub.html#Examples.Person"><span class="id" type="definition">Person</span></a></span>.  Also suppose, even
    though we haven't yet discussed subtyping for records, that
    <span class="inlinecode"><a class="idref" href="Sub.html#Examples.Student"><span class="id" type="definition">Student</span></a></span> is a subtype of <span class="inlinecode"><a class="idref" href="Sub.html#Examples.Person"><span class="id" type="definition">Person</span></a></span>.  Then the application <span class="inlinecode"><a class="idref" href="Records.html#STLCExtendedRecords.g"><span class="id" type="abbreviation">g</span></a></span> <span class="inlinecode"><a class="idref" href="Records.html#STLCExtendedRecords.f"><span class="id" type="abbreviation">f</span></a></span> is
    safe even though their types do not match up precisely, because
    the only thing <span class="inlinecode"><a class="idref" href="Records.html#STLCExtendedRecords.g"><span class="id" type="abbreviation">g</span></a></span> can do with <span class="inlinecode"><a class="idref" href="Records.html#STLCExtendedRecords.f"><span class="id" type="abbreviation">f</span></a></span> is to apply it to some
    argument (of type <span class="inlinecode"><a class="idref" href="RecordSub.html#Examples.C"><span class="id" type="abbreviation">C</span></a></span>); the result will actually be a <span class="inlinecode"><a class="idref" href="Sub.html#Examples.Student"><span class="id" type="definition">Student</span></a></span>,
    while <span class="inlinecode"><a class="idref" href="Records.html#STLCExtendedRecords.g"><span class="id" type="abbreviation">g</span></a></span> will be expecting a <span class="inlinecode"><a class="idref" href="Sub.html#Examples.Person"><span class="id" type="definition">Person</span></a></span>, but this is safe because
    the only thing <span class="inlinecode"><a class="idref" href="Records.html#STLCExtendedRecords.g"><span class="id" type="abbreviation">g</span></a></span> can then do is to project out the two fields
    that it knows about (<span class="inlinecode"><span class="id" type="var">name</span></span> and <span class="inlinecode"><span class="id" type="var">age</span></span>), and these will certainly
    be among the fields that are present.

<div class="paragraph"> </div>

    This example suggests that the subtyping rule for arrow types
    should say that two arrow types are in the subtype relation if
    their results are:
                                  S2 &lt;: T2
<hr/>
                     (S_Arrow_Co)
                            S1 -&gt; S2 &lt;: S1 -&gt; T2
    We can generalize this to allow the arguments of the two arrow
    types to be in the subtype relation as well:
                            T1 &lt;: S1    S2 &lt;: T2
<hr/>
                      (S_Arrow)
                            S1 -&gt; S2 &lt;: T1 -&gt; T2
    Notice that the argument types are subtypes "the other way round":
    in order to conclude that <span class="inlinecode"><a class="idref" href="Sub.html#S1"><span class="id" type="variable">S1</span></a>→<a class="idref" href="Sub.html#S2"><span class="id" type="variable">S2</span></a></span> to be a subtype of <span class="inlinecode"><a class="idref" href="StlcProp.html#T1"><span class="id" type="variable">T1</span></a>→<a class="idref" href="StlcProp.html#T2"><span class="id" type="variable">T2</span></a></span>, it
    must be the case that <span class="inlinecode"><a class="idref" href="StlcProp.html#T1"><span class="id" type="variable">T1</span></a></span> is a subtype of <span class="inlinecode"><a class="idref" href="Sub.html#S1"><span class="id" type="variable">S1</span></a></span>.  The arrow
    constructor is said to be <i>contravariant</i> in its first argument
    and <i>covariant</i> in its second. 

<div class="paragraph"> </div>

    Here is an example that illustrates this: 
       f : Person -&gt; C
       g : (Student -&gt; C) -&gt; D
    The application <span class="inlinecode"><a class="idref" href="Records.html#STLCExtendedRecords.g"><span class="id" type="abbreviation">g</span></a></span> <span class="inlinecode"><a class="idref" href="Records.html#STLCExtendedRecords.f"><span class="id" type="abbreviation">f</span></a></span> is safe, because the only thing the body of
    <span class="inlinecode"><a class="idref" href="Records.html#STLCExtendedRecords.g"><span class="id" type="abbreviation">g</span></a></span> can do with <span class="inlinecode"><a class="idref" href="Records.html#STLCExtendedRecords.f"><span class="id" type="abbreviation">f</span></a></span> is to apply it to some argument of type
    <span class="inlinecode"><a class="idref" href="Sub.html#Examples.Student"><span class="id" type="definition">Student</span></a></span>.  Since <span class="inlinecode"><a class="idref" href="Records.html#STLCExtendedRecords.f"><span class="id" type="abbreviation">f</span></a></span> requires records having (at least) the
    fields of a <span class="inlinecode"><a class="idref" href="Sub.html#Examples.Person"><span class="id" type="definition">Person</span></a></span>, this will always work. So <span class="inlinecode"><a class="idref" href="Sub.html#Examples.Person"><span class="id" type="definition">Person</span></a></span> <span class="inlinecode">→</span> <span class="inlinecode"><a class="idref" href="RecordSub.html#Examples.C"><span class="id" type="abbreviation">C</span></a></span> is a
    subtype of <span class="inlinecode"><a class="idref" href="Sub.html#Examples.Student"><span class="id" type="definition">Student</span></a></span> <span class="inlinecode">→</span> <span class="inlinecode"><a class="idref" href="RecordSub.html#Examples.C"><span class="id" type="abbreviation">C</span></a></span> since <span class="inlinecode"><a class="idref" href="Sub.html#Examples.Student"><span class="id" type="definition">Student</span></a></span> is a subtype of
    <span class="inlinecode"><a class="idref" href="Sub.html#Examples.Person"><span class="id" type="definition">Person</span></a></span>.

<div class="paragraph"> </div>

    The intuition is that, if we have a function <span class="inlinecode"><a class="idref" href="Records.html#STLCExtendedRecords.f"><span class="id" type="abbreviation">f</span></a></span> of type <span class="inlinecode"><a class="idref" href="Sub.html#S1"><span class="id" type="variable">S1</span></a>→<a class="idref" href="Sub.html#S2"><span class="id" type="variable">S2</span></a></span>,
    then we know that <span class="inlinecode"><a class="idref" href="Records.html#STLCExtendedRecords.f"><span class="id" type="abbreviation">f</span></a></span> accepts elements of type <span class="inlinecode"><a class="idref" href="Sub.html#S1"><span class="id" type="variable">S1</span></a></span>; clearly, <span class="inlinecode"><a class="idref" href="Records.html#STLCExtendedRecords.f"><span class="id" type="abbreviation">f</span></a></span>
    will also accept elements of any subtype <span class="inlinecode"><a class="idref" href="StlcProp.html#T1"><span class="id" type="variable">T1</span></a></span> of <span class="inlinecode"><a class="idref" href="Sub.html#S1"><span class="id" type="variable">S1</span></a></span>. The type of
    <span class="inlinecode"><a class="idref" href="Records.html#STLCExtendedRecords.f"><span class="id" type="abbreviation">f</span></a></span> also tells us that it returns elements of type <span class="inlinecode"><a class="idref" href="Sub.html#S2"><span class="id" type="variable">S2</span></a></span>; we can
    also view these results belonging to any supertype <span class="inlinecode"><a class="idref" href="StlcProp.html#T2"><span class="id" type="variable">T2</span></a></span> of
    <span class="inlinecode"><a class="idref" href="Sub.html#S2"><span class="id" type="variable">S2</span></a></span>. That is, any function <span class="inlinecode"><a class="idref" href="Records.html#STLCExtendedRecords.f"><span class="id" type="abbreviation">f</span></a></span> of type <span class="inlinecode"><a class="idref" href="Sub.html#S1"><span class="id" type="variable">S1</span></a>→<a class="idref" href="Sub.html#S2"><span class="id" type="variable">S2</span></a></span> can also be
    viewed as having type <span class="inlinecode"><a class="idref" href="StlcProp.html#T1"><span class="id" type="variable">T1</span></a>→<a class="idref" href="StlcProp.html#T2"><span class="id" type="variable">T2</span></a></span>. 

<div class="paragraph"> </div>

<a name="lab775"></a><h3 class="section">Records</h3>

<div class="paragraph"> </div>

 What about subtyping for record types? 
<div class="paragraph"> </div>

 The basic intuition about subtyping for record types is that it is
   always safe to use a "bigger" record in place of a "smaller" one.
   That is, given a record type, adding extra fields will always
   result in a subtype.  If some code is expecting a record with
   fields <span class="inlinecode"><a class="idref" href="RecordSub.html#Examples.x"><span class="id" type="abbreviation">x</span></a></span> and <span class="inlinecode"><a class="idref" href="RecordSub.html#Examples.y"><span class="id" type="abbreviation">y</span></a></span>, it is perfectly safe for it to receive a record
   with fields <span class="inlinecode"><a class="idref" href="RecordSub.html#Examples.x"><span class="id" type="abbreviation">x</span></a></span>, <span class="inlinecode"><a class="idref" href="RecordSub.html#Examples.y"><span class="id" type="abbreviation">y</span></a></span>, and <span class="inlinecode"><a class="idref" href="RecordSub.html#Examples.z"><span class="id" type="abbreviation">z</span></a></span>; the <span class="inlinecode"><a class="idref" href="RecordSub.html#Examples.z"><span class="id" type="abbreviation">z</span></a></span> field will simply be ignored.
   For example,
       {name:String, age:Nat, gpa:Nat} &lt;: {name:String, age:Nat}
       {name:String, age:Nat} &lt;: {name:String}
       {name:String} &lt;: {}
   This is known as "width subtyping" for records. 
<div class="paragraph"> </div>

 We can also create a subtype of a record type by replacing the type
   of one of its fields with a subtype.  If some code is expecting a
   record with a field <span class="inlinecode"><a class="idref" href="RecordSub.html#Examples.x"><span class="id" type="abbreviation">x</span></a></span> of type <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span>, it will be happy with a record
   having a field <span class="inlinecode"><a class="idref" href="RecordSub.html#Examples.x"><span class="id" type="abbreviation">x</span></a></span> of type <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a></span> as long as <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a></span> is a subtype of
   <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span>. For example,
       {x:Student} &lt;: {x:Person}
   This is known as "depth subtyping". 
<div class="paragraph"> </div>

 Finally, although the fields of a record type are written in a
   particular order, the order does not really matter. For example, 
       {name:String,age:Nat} &lt;: {age:Nat,name:String}
   This is known as "permutation subtyping". 
<div class="paragraph"> </div>

 We could formalize these requirements in a single subtyping rule
   for records as follows:
                        for each jk in j1..jn,
                    exists ip in i1..im, such that
                          jk=ip and Sp &lt;: Tk
<hr/>
                    (S_Rcd)
                  {i1:S1...im:Sm} &lt;: {j1:T1...jn:Tn}
   That is, the record on the left should have all the field labels of
   the one on the right (and possibly more), while the types of the
   common fields should be in the subtype relation. However, this rule
   is rather heavy and hard to read.  If we like, we can decompose it
   into three simpler rules, which can be combined using <span class="inlinecode"><a class="idref" href="RecordSub.html#S_Trans"><span class="id" type="constructor">S_Trans</span></a></span> to
   achieve all the same effects. 
<div class="paragraph"> </div>

 First, adding fields to the end of a record type gives a subtype:
                               n &gt; m
<hr/>
                 (S_RcdWidth)
                 {i1:T1...in:Tn} &lt;: {i1:T1...im:Tm} 
   We can use <span class="inlinecode"><a class="idref" href="RecordSub.html#S_RcdWidth"><span class="id" type="constructor">S_RcdWidth</span></a></span> to drop later fields of a multi-field
   record while keeping earlier fields, showing for example that
   <span class="inlinecode">{<span class="id" type="var">age</span>:<span class="id" type="var">Nat</span>,<span class="id" type="var">name</span>:<a class="idref" href="Sub.html#Examples.String"><span class="id" type="abbreviation">String</span></a>}</span> <span class="inlinecode">&lt;:</span> <span class="inlinecode">{<span class="id" type="var">name</span>:<a class="idref" href="Sub.html#Examples.String"><span class="id" type="abbreviation">String</span></a>}</span>. 
<div class="paragraph"> </div>

 Second, we can apply subtyping inside the components of a compound
   record type:
                       S1 &lt;: T1  ...  Sn &lt;: Tn
<hr/>
               (S_RcdDepth)
                  {i1:S1...in:Sn} &lt;: {i1:T1...in:Tn}
   For example, we can use <span class="inlinecode"><a class="idref" href="RecordSub.html#S_RcdDepth"><span class="id" type="constructor">S_RcdDepth</span></a></span> and <span class="inlinecode"><a class="idref" href="RecordSub.html#S_RcdWidth"><span class="id" type="constructor">S_RcdWidth</span></a></span> together to
   show that <span class="inlinecode">{<a class="idref" href="RecordSub.html#Examples.y"><span class="id" type="abbreviation">y</span></a>:<a class="idref" href="Sub.html#Examples.Student"><span class="id" type="definition">Student</span></a>,</span> <span class="inlinecode"><a class="idref" href="RecordSub.html#Examples.x"><span class="id" type="abbreviation">x</span></a>:<span class="id" type="var">Nat</span>}</span> <span class="inlinecode">&lt;:</span> <span class="inlinecode">{<a class="idref" href="RecordSub.html#Examples.y"><span class="id" type="abbreviation">y</span></a>:<a class="idref" href="Sub.html#Examples.Person"><span class="id" type="definition">Person</span></a>}</span>. 
<div class="paragraph"> </div>

 Third, we need to be able to reorder fields.  For example, we
   might expect that <span class="inlinecode">{<span class="id" type="var">name</span>:<a class="idref" href="Sub.html#Examples.String"><span class="id" type="abbreviation">String</span></a>,</span> <span class="inlinecode"><span class="id" type="var">gpa</span>:<span class="id" type="var">Nat</span>,</span> <span class="inlinecode"><span class="id" type="var">age</span>:<span class="id" type="var">Nat</span>}</span> <span class="inlinecode">&lt;:</span> <span class="inlinecode"><a class="idref" href="Sub.html#Examples.Person"><span class="id" type="definition">Person</span></a></span>.  We
   haven't quite achieved this yet: using just <span class="inlinecode"><a class="idref" href="RecordSub.html#S_RcdDepth"><span class="id" type="constructor">S_RcdDepth</span></a></span> and
   <span class="inlinecode"><a class="idref" href="RecordSub.html#S_RcdWidth"><span class="id" type="constructor">S_RcdWidth</span></a></span> we can only drop fields from the <i>end</i> of a record
   type.  So we need:
         {i1:S1...in:Sn} is a permutation of {i1:T1...in:Tn}
<hr/>
        (S_RcdPerm)
                  {i1:S1...in:Sn} &lt;: {i1:T1...in:Tn}

<div class="paragraph"> </div>

 It is worth noting that full-blown language designs may choose not
    to adopt all of these subtyping rules. For example, in Java:

<div class="paragraph"> </div>

<ul class="doclist">
<li> A subclass may not change the argument or result types of a
      method of its superclass (i.e., no depth subtyping or no arrow
      subtyping, depending how you look at it).

<div class="paragraph"> </div>


</li>
<li> Each class has just one superclass ("single inheritance" of
      classes).

<div class="paragraph"> </div>


</li>
<li> Each class member (field or method) can be assigned a single
      index, adding new indices "on the right" as more members are
      added in subclasses (i.e., no permutation for classes).

<div class="paragraph"> </div>


</li>
<li> A class may implement multiple interfaces -- so-called "multiple
      inheritance" of interfaces (i.e., permutation is allowed for
      interfaces). 
</li>
</ul>

<div class="paragraph"> </div>

<a name="lab776"></a><h4 class="section">Exercise: 2 stars (arrow_sub_wrong)</h4>
 Suppose we had incorrectly defined subtyping as covariant on both
    the right and the left of arrow types:
                            S1 &lt;: T1    S2 &lt;: T2
<hr/>
                (S_Arrow_wrong)
                            S1 -&gt; S2 &lt;: T1 -&gt; T2
    Give a concrete example of functions <span class="inlinecode"><a class="idref" href="Records.html#STLCExtendedRecords.f"><span class="id" type="abbreviation">f</span></a></span> and <span class="inlinecode"><a class="idref" href="Records.html#STLCExtendedRecords.g"><span class="id" type="abbreviation">g</span></a></span> with the following types...
       f : Student -&gt; Nat
       g : (Person -&gt; Nat) -&gt; Nat
    ... such that the application <span class="inlinecode"><a class="idref" href="Records.html#STLCExtendedRecords.g"><span class="id" type="abbreviation">g</span></a></span> <span class="inlinecode"><a class="idref" href="Records.html#STLCExtendedRecords.f"><span class="id" type="abbreviation">f</span></a></span> will get stuck during
    execution.

<div class="paragraph"> </div>

<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

<a name="lab777"></a><h3 class="section">Top</h3>

<div class="paragraph"> </div>

 Finally, it is natural to give the subtype relation a maximal
    element -- a type that lies above every other type and is
    inhabited by all (well-typed) values.  We do this by adding to the
    language one new type constant, called <span class="inlinecode"><span class="id" type="var">Top</span></span>, together with a
    subtyping rule that places it above every other type in the
    subtype relation:
<hr/>
                             (S_Top)
                                   S &lt;: Top
    The <span class="inlinecode"><span class="id" type="var">Top</span></span> type is an analog of the <span class="inlinecode"><span class="id" type="var">Object</span></span> type in Java and C<span class="inlinecode">#</span>. 
</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a name="lab778"></a><h3 class="section">Summary</h3>

<div class="paragraph"> </div>

 In summary, we form the STLC with subtyping by starting with the
    pure STLC (over some set of base types) and...

<div class="paragraph"> </div>

<ul class="doclist">
<li> adding a base type <span class="inlinecode"><span class="id" type="var">Top</span></span>,

<div class="paragraph"> </div>


</li>
<li> adding the rule of subsumption 
                         Gamma |- t : S     S &lt;: T
<ul class="doclist">
<li>------------------------                      (T_Sub)
                               Gamma |- t : T

</li>
</ul>
      to the typing relation, and

<div class="paragraph"> </div>


</li>
<li> defining a subtype relation as follows: 
                              S &lt;: U    U &lt;: T
<ul class="doclist">
<li>---------------                        (S_Trans)
                                   S &lt;: T

<div class="paragraph"> </div>

<ul class="doclist">
<li>-----                              (S_Refl)

</li>
</ul>
                                   T &lt;: T

<div class="paragraph"> </div>

<ul class="doclist">
<li>-------                             (S_Top)

</li>
</ul>
                                   S &lt;: Top

<div class="paragraph"> </div>


</li>
</ul>
                            S1 &lt;: T1    S2 &lt;: T2
<ul class="doclist">
<li>-------------------                       (S_Prod)
                             S1 * S2 &lt;: T1 * T2

<div class="paragraph"> </div>


</li>
</ul>
                            T1 &lt;: S1    S2 &lt;: T2
<ul class="doclist">
<li>-------------------                      (S_Arrow)

</li>
</ul>
                            S1 -&gt; S2 &lt;: T1 -&gt; T2

<div class="paragraph"> </div>

                               n &gt; m
<ul class="doclist">
<li>--------------------------------                 (S_RcdWidth)

</li>
</ul>
                 {i1:T1...in:Tn} &lt;: {i1:T1...im:Tm} 

<div class="paragraph"> </div>

                       S1 &lt;: T1  ...  Sn &lt;: Tn
<ul class="doclist">
<li>---------------------------------               (S_RcdDepth)

</li>
</ul>
                  {i1:S1...in:Sn} &lt;: {i1:T1...in:Tn}

<div class="paragraph"> </div>

         {i1:S1...in:Sn} is a permutation of {i1:T1...in:Tn}
<ul class="doclist">
<li>--------------------------------------------------        (S_RcdPerm)
                  {i1:S1...in:Sn} &lt;: {i1:T1...in:Tn}

</li>
</ul>

</li>
</ul>

</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a name="lab779"></a><h2 class="section">Exercises</h2>

<div class="paragraph"> </div>

<a name="lab780"></a><h4 class="section">Exercise: 1 star, optional (subtype_instances_tf_1)</h4>
 Suppose we have types <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a></span>, <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span>, <span class="inlinecode"><a class="idref" href="Auto.html#U"><span class="id" type="variable">U</span></a></span>, and <span class="inlinecode"><a class="idref" href="HoareAsLogic.html#V"><span class="id" type="variable">V</span></a></span> with <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a></span> <span class="inlinecode">&lt;:</span> <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span>
    and <span class="inlinecode"><a class="idref" href="Auto.html#U"><span class="id" type="variable">U</span></a></span> <span class="inlinecode">&lt;:</span> <span class="inlinecode"><a class="idref" href="HoareAsLogic.html#V"><span class="id" type="variable">V</span></a></span>.  Which of the following subtyping assertions
    are then true?  Write <i>true</i> or <i>false</i> after each one.  
    (<span class="inlinecode"><a class="idref" href="RecordSub.html#Examples.A"><span class="id" type="abbreviation">A</span></a></span>, <span class="inlinecode"><a class="idref" href="RecordSub.html#Examples.B"><span class="id" type="abbreviation">B</span></a></span>, and <span class="inlinecode"><a class="idref" href="RecordSub.html#Examples.C"><span class="id" type="abbreviation">C</span></a></span> here are base types.)

<div class="paragraph"> </div>

<ul class="doclist">
<li> <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a>→<a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a></span> <span class="inlinecode">&lt;:</span> <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a>→<a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a></span>

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode"><span class="id" type="var">Top</span>→<a class="idref" href="Auto.html#U"><span class="id" type="variable">U</span></a></span> <span class="inlinecode">&lt;:</span> <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a>→<span class="id" type="var">Top</span></span>

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode">(<a class="idref" href="RecordSub.html#Examples.C"><span class="id" type="abbreviation">C</span></a>→<a class="idref" href="RecordSub.html#Examples.C"><span class="id" type="abbreviation">C</span></a>)</span> <span class="inlinecode">→</span> <span class="inlinecode">(<a class="idref" href="RecordSub.html#Examples.A"><span class="id" type="abbreviation">A</span></a>×<a class="idref" href="RecordSub.html#Examples.B"><span class="id" type="abbreviation">B</span></a>)</span>  <span class="inlinecode">&lt;:</span>  <span class="inlinecode">(<a class="idref" href="RecordSub.html#Examples.C"><span class="id" type="abbreviation">C</span></a>→<a class="idref" href="RecordSub.html#Examples.C"><span class="id" type="abbreviation">C</span></a>)</span> <span class="inlinecode">→</span> <span class="inlinecode">(<span class="id" type="var">Top</span>×<a class="idref" href="RecordSub.html#Examples.B"><span class="id" type="abbreviation">B</span></a>)</span>

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a>→<a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a>→<a class="idref" href="Auto.html#U"><span class="id" type="variable">U</span></a></span> <span class="inlinecode">&lt;:</span> <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a>→<a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a>→<a class="idref" href="HoareAsLogic.html#V"><span class="id" type="variable">V</span></a></span>

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode">(<a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a>→<a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a>)-&gt;<a class="idref" href="Auto.html#U"><span class="id" type="variable">U</span></a></span> <span class="inlinecode">&lt;:</span> <span class="inlinecode">(<a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a>→<a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a>)-&gt;<a class="idref" href="HoareAsLogic.html#V"><span class="id" type="variable">V</span></a></span>

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode">((<a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a>→<a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a>)-&gt;<a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a>)-&gt;<a class="idref" href="Auto.html#U"><span class="id" type="variable">U</span></a></span> <span class="inlinecode">&lt;:</span> <span class="inlinecode">((<a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a>→<a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a>)-&gt;<a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a>)-&gt;<a class="idref" href="HoareAsLogic.html#V"><span class="id" type="variable">V</span></a></span>

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a>×<a class="idref" href="HoareAsLogic.html#V"><span class="id" type="variable">V</span></a></span> <span class="inlinecode">&lt;:</span> <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a>×<a class="idref" href="Auto.html#U"><span class="id" type="variable">U</span></a></span>

</li>
</ul>

<div class="paragraph"> </div>

<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

<a name="lab781"></a><h4 class="section">Exercise: 2 stars (subtype_order)</h4>
 The following types happen to form a linear order with respect to subtyping:

<div class="paragraph"> </div>

<ul class="doclist">
<li> <span class="inlinecode"><span class="id" type="var">Top</span></span>

</li>
<li> <span class="inlinecode"><span class="id" type="var">Top</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><a class="idref" href="Sub.html#Examples.Student"><span class="id" type="definition">Student</span></a></span>

</li>
<li> <span class="inlinecode"><a class="idref" href="Sub.html#Examples.Student"><span class="id" type="definition">Student</span></a></span> <span class="inlinecode">→</span> <span class="inlinecode"><a class="idref" href="Sub.html#Examples.Person"><span class="id" type="definition">Person</span></a></span>

</li>
<li> <span class="inlinecode"><a class="idref" href="Sub.html#Examples.Student"><span class="id" type="definition">Student</span></a></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" type="var">Top</span></span>

</li>
<li> <span class="inlinecode"><a class="idref" href="Sub.html#Examples.Person"><span class="id" type="definition">Person</span></a></span> <span class="inlinecode">→</span> <span class="inlinecode"><a class="idref" href="Sub.html#Examples.Student"><span class="id" type="definition">Student</span></a></span>

</li>
</ul>

<div class="paragraph"> </div>

Write these types in order from the most specific to the most general.

<div class="paragraph"> </div>

Where does the type <span class="inlinecode"><span class="id" type="var">Top</span>→<span class="id" type="var">Top</span>→<a class="idref" href="Sub.html#Examples.Student"><span class="id" type="definition">Student</span></a></span> fit into this order?

<div class="paragraph"> </div>


<div class="paragraph"> </div>

<a name="lab782"></a><h4 class="section">Exercise: 1 star (subtype_instances_tf_2)</h4>
 Which of the following statements are true?  Write <i>true</i> or
    <i>false</i> after each one.
      forall S T,
          S &lt;: T  -&gt;
          S-&gt;S   &lt;:  T-&gt;T

<div class="paragraph"> </div>

      forall S,
           S &lt;: A-&gt;A -&gt;
           exists T,
              S = T-&gt;T  /\  T &lt;: A

<div class="paragraph"> </div>

      forall S T1 T2,
           (S &lt;: T1 -&gt; T2) -&gt;
           exists S1 S2,
              S = S1 -&gt; S2  /\  T1 &lt;: S1  /\  S2 &lt;: T2 

<div class="paragraph"> </div>

      exists S,
           S &lt;: S-&gt;S 

<div class="paragraph"> </div>

      exists S,
           S-&gt;S &lt;: S   

<div class="paragraph"> </div>

      forall S T1 T2,
           S &lt;: T1*T2 -&gt;
           exists S1 S2,
              S = S1*S2  /\  S1 &lt;: T1  /\  S2 &lt;: T2  
<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

<a name="lab783"></a><h4 class="section">Exercise: 1 star (subtype_concepts_tf)</h4>
 Which of the following statements are true, and which are false?

<div class="paragraph"> </div>

<ul class="doclist">
<li> There exists a type that is a supertype of every other type.

<div class="paragraph"> </div>


</li>
<li> There exists a type that is a subtype of every other type.

<div class="paragraph"> </div>


</li>
<li> There exists a pair type that is a supertype of every other
      pair type.

<div class="paragraph"> </div>


</li>
<li> There exists a pair type that is a subtype of every other
      pair type.

<div class="paragraph"> </div>


</li>
<li> There exists an arrow type that is a supertype of every other
      arrow type.

<div class="paragraph"> </div>


</li>
<li> There exists an arrow type that is a subtype of every other
      arrow type.

<div class="paragraph"> </div>


</li>
<li> There is an infinite descending chain of distinct types in the
      subtype relation---that is, an infinite sequence of types
      <span class="inlinecode"><span class="id" type="var">S0</span></span>, <span class="inlinecode"><a class="idref" href="Sub.html#S1"><span class="id" type="variable">S1</span></a></span>, etc., such that all the <span class="inlinecode"><a class="idref" href="RecordSub.html#Si"><span class="id" type="variable">Si</span></a></span>'s are different and
      each <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a>(<a class="idref" href="RecordSub.html#Examples.i"><span class="id" type="abbreviation">i</span></a>+1)</span> is a subtype of <span class="inlinecode"><a class="idref" href="RecordSub.html#Si"><span class="id" type="variable">Si</span></a></span>.

<div class="paragraph"> </div>


</li>
<li> There is an infinite <i>ascending</i> chain of distinct types in
      the subtype relation---that is, an infinite sequence of types
      <span class="inlinecode"><span class="id" type="var">S0</span></span>, <span class="inlinecode"><a class="idref" href="Sub.html#S1"><span class="id" type="variable">S1</span></a></span>, etc., such that all the <span class="inlinecode"><a class="idref" href="RecordSub.html#Si"><span class="id" type="variable">Si</span></a></span>'s are different and
      each <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a>(<a class="idref" href="RecordSub.html#Examples.i"><span class="id" type="abbreviation">i</span></a>+1)</span> is a supertype of <span class="inlinecode"><a class="idref" href="RecordSub.html#Si"><span class="id" type="variable">Si</span></a></span>.

</li>
</ul>

<div class="paragraph"> </div>

<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

<a name="lab784"></a><h4 class="section">Exercise: 2 stars (proper_subtypes)</h4>
 Is the following statement true or false?  Briefly explain your
    answer.
    forall T,
         ~(exists n, T = TBase n) -&gt;
         exists S,
            S &lt;: T  /\  S &lt;&gt; T
]] 
<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

<a name="lab785"></a><h4 class="section">Exercise: 2 stars (small_large_1)</h4>

<div class="paragraph"> </div>

<ul class="doclist">
<li> What is the <i>smallest</i> type <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> ("smallest" in the subtype
     relation) that makes the following assertion true?  (Assume we
     have <span class="inlinecode"><span class="id" type="var">Unit</span></span> among the base types and <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#unit"><span class="id" type="inductive">unit</span></a></span> as a constant of this
     type.)
       empty |- (\p:T*Top. p.fst) ((\z:A.z), unit) : A-&gt;A

<div class="paragraph"> </div>


</li>
<li> What is the <i>largest</i> type <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> that makes the same assertion true?

</li>
</ul>

<div class="paragraph"> </div>

<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

<a name="lab786"></a><h4 class="section">Exercise: 2 stars (small_large_2)</h4>

<div class="paragraph"> </div>

<ul class="doclist">
<li> What is the <i>smallest</i> type <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> that makes the following
     assertion true?
       empty |- (\p:(A-&gt;A * B-&gt;B). p) ((\z:A.z), (\z:B.z)) : T

<div class="paragraph"> </div>


</li>
<li> What is the <i>largest</i> type <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> that makes the same assertion true?

</li>
</ul>

<div class="paragraph"> </div>

<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

<a name="lab787"></a><h4 class="section">Exercise: 2 stars, optional (small_large_3)</h4>

<div class="paragraph"> </div>

<ul class="doclist">
<li> What is the <i>smallest</i> type <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> that makes the following
     assertion true?
       a:A |- (\p:(A*T). (p.snd) (p.fst)) (a , \z:A.z) : A

<div class="paragraph"> </div>


</li>
<li> What is the <i>largest</i> type <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> that makes the same assertion true?

</li>
</ul>

<div class="paragraph"> </div>

<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

<a name="lab788"></a><h4 class="section">Exercise: 2 stars (small_large_4)</h4>

<div class="paragraph"> </div>

<ul class="doclist">
<li> What is the <i>smallest</i> type <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> that makes the following
     assertion true?
       exists S,
         empty |- (\p:(A*T). (p.snd) (p.fst)) : S

<div class="paragraph"> </div>


</li>
<li> What is the <i>largest</i> type <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> that makes the same
     assertion true?

</li>
</ul>

<div class="paragraph"> </div>

<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

<a name="lab789"></a><h4 class="section">Exercise: 2 stars (smallest_1)</h4>
 What is the <i>smallest</i> type <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> that makes the following
    assertion true?
      exists S, exists t, 
        empty |- (\x:T. x x) t : S
]] 
<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

<a name="lab790"></a><h4 class="section">Exercise: 2 stars (smallest_2)</h4>
 What is the <i>smallest</i> type <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> that makes the following
    assertion true?
      empty |- (\x:Top. x) ((\z:A.z) , (\z:B.z)) : T
]] 
<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

<a name="lab791"></a><h4 class="section">Exercise: 3 stars, optional (count_supertypes)</h4>
 How many supertypes does the record type <span class="inlinecode">{<a class="idref" href="RecordSub.html#Examples.x"><span class="id" type="abbreviation">x</span></a>:<a class="idref" href="RecordSub.html#Examples.A"><span class="id" type="abbreviation">A</span></a>,</span> <span class="inlinecode"><a class="idref" href="RecordSub.html#Examples.y"><span class="id" type="abbreviation">y</span></a>:<a class="idref" href="RecordSub.html#Examples.C"><span class="id" type="abbreviation">C</span></a>→<a class="idref" href="RecordSub.html#Examples.C"><span class="id" type="abbreviation">C</span></a>}</span> have?  That is,
    how many different types <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> are there such that <span class="inlinecode">{<a class="idref" href="RecordSub.html#Examples.x"><span class="id" type="abbreviation">x</span></a>:<a class="idref" href="RecordSub.html#Examples.A"><span class="id" type="abbreviation">A</span></a>,</span> <span class="inlinecode"><a class="idref" href="RecordSub.html#Examples.y"><span class="id" type="abbreviation">y</span></a>:<a class="idref" href="RecordSub.html#Examples.C"><span class="id" type="abbreviation">C</span></a>→<a class="idref" href="RecordSub.html#Examples.C"><span class="id" type="abbreviation">C</span></a>}</span> <span class="inlinecode">&lt;:</span>
    <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span>?  (We consider two types to be different if they are written
    differently, even if each is a subtype of the other.  For example,
    <span class="inlinecode">{<a class="idref" href="RecordSub.html#Examples.x"><span class="id" type="abbreviation">x</span></a>:<a class="idref" href="RecordSub.html#Examples.A"><span class="id" type="abbreviation">A</span></a>,<a class="idref" href="RecordSub.html#Examples.y"><span class="id" type="abbreviation">y</span></a>:<a class="idref" href="RecordSub.html#Examples.B"><span class="id" type="abbreviation">B</span></a>}</span> and <span class="inlinecode">{<a class="idref" href="RecordSub.html#Examples.y"><span class="id" type="abbreviation">y</span></a>:<a class="idref" href="RecordSub.html#Examples.B"><span class="id" type="abbreviation">B</span></a>,<a class="idref" href="RecordSub.html#Examples.x"><span class="id" type="abbreviation">x</span></a>:<a class="idref" href="RecordSub.html#Examples.A"><span class="id" type="abbreviation">A</span></a>}</span> are different.)

<div class="paragraph"> </div>

<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

<a name="lab792"></a><h4 class="section">Exercise: 2 stars (pair_permutation)</h4>
 The subtyping rule for product types
                            S1 &lt;: T1    S2 &lt;: T2
<hr/>
                        (S_Prod)
                               S1*S2 &lt;: T1*T2
intuitively corresponds to the "depth" subtyping rule for records. Extending the analogy, we might consider adding a "permutation" rule 
<hr/>

                                   T1*T2 &lt;: T2*T1
for products.
Is this a good idea? Briefly explain why or why not.

<div class="paragraph"> </div>

<font size=-2>&#9744;</font> 
</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a name="lab793"></a><h1 class="section">Formal Definitions</h1>

<div class="paragraph"> </div>

 Most of the definitions -- in particular, the syntax and
    operational semantics of the language -- are identical to what we
    saw in the last chapter.  We just need to extend the typing
    relation with the subsumption rule and add a new <span class="inlinecode"><span class="id" type="keyword">Inductive</span></span>
    definition for the subtyping relation.  Let's first do the
    identical bits. 
</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a name="lab794"></a><h2 class="section">Core Definitions</h2>

</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a name="lab795"></a><h3 class="section">Syntax</h3>

<div class="paragraph"> </div>

 For the sake of more interesting examples below, we'll allow an
    arbitrary set of additional base types like <span class="inlinecode"><a class="idref" href="Sub.html#Examples.String"><span class="id" type="abbreviation">String</span></a></span>, <span class="inlinecode"><a class="idref" href="Sub.html#Examples.Float"><span class="id" type="abbreviation">Float</span></a></span>,
    etc.  We won't bother adding any constants belonging to these
    types or any operators on them, but we could easily do so. 
<div class="paragraph"> </div>

 In the rest of the chapter, we formalize just base types,
    booleans, arrow types, <span class="inlinecode"><span class="id" type="var">Unit</span></span>, and <span class="inlinecode"><span class="id" type="var">Top</span></span>, omitting record types
    and leaving product types as an exercise. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Inductive</span> <a name="ty"><span class="id" type="inductive">ty</span></a> : <span class="id" type="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <a name="TTop"><span class="id" type="constructor">TTop</span></a>   : <a class="idref" href="Sub.html#ty"><span class="id" type="inductive">ty</span></a><br/>
&nbsp;&nbsp;| <a name="TBool"><span class="id" type="constructor">TBool</span></a>  : <a class="idref" href="Sub.html#ty"><span class="id" type="inductive">ty</span></a><br/>
&nbsp;&nbsp;| <a name="TBase"><span class="id" type="constructor">TBase</span></a>  : <a class="idref" href="SfLib.html#id"><span class="id" type="inductive">id</span></a> → <a class="idref" href="Sub.html#ty"><span class="id" type="inductive">ty</span></a><br/>
&nbsp;&nbsp;| <a name="TArrow"><span class="id" type="constructor">TArrow</span></a> : <a class="idref" href="Sub.html#ty"><span class="id" type="inductive">ty</span></a> → <a class="idref" href="Sub.html#ty"><span class="id" type="inductive">ty</span></a> → <a class="idref" href="Sub.html#ty"><span class="id" type="inductive">ty</span></a><br/>
&nbsp;&nbsp;| <a name="TUnit"><span class="id" type="constructor">TUnit</span></a>  : <a class="idref" href="Sub.html#ty"><span class="id" type="inductive">ty</span></a><br/>
.<br/>

<br/>
<span class="id" type="keyword">Tactic Notation</span> "T_cases" <span class="id" type="var">tactic</span>(<span class="id" type="tactic">first</span>) <span class="id" type="var">ident</span>(<span class="id" type="var">c</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="tactic">first</span>;<br/>
&nbsp;&nbsp;[ <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "TTop" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "TBool" <br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "TBase" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "TArrow" <br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "TUnit" | <br/>
&nbsp;&nbsp;].<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <a name="tm"><span class="id" type="inductive">tm</span></a> : <span class="id" type="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <a name="tvar"><span class="id" type="constructor">tvar</span></a> : <a class="idref" href="SfLib.html#id"><span class="id" type="inductive">id</span></a> → <a class="idref" href="Sub.html#tm"><span class="id" type="inductive">tm</span></a><br/>
&nbsp;&nbsp;| <a name="tapp"><span class="id" type="constructor">tapp</span></a> : <a class="idref" href="Sub.html#tm"><span class="id" type="inductive">tm</span></a> → <a class="idref" href="Sub.html#tm"><span class="id" type="inductive">tm</span></a> → <a class="idref" href="Sub.html#tm"><span class="id" type="inductive">tm</span></a><br/>
&nbsp;&nbsp;| <a name="tabs"><span class="id" type="constructor">tabs</span></a> : <a class="idref" href="SfLib.html#id"><span class="id" type="inductive">id</span></a> → <a class="idref" href="Sub.html#ty"><span class="id" type="inductive">ty</span></a> → <a class="idref" href="Sub.html#tm"><span class="id" type="inductive">tm</span></a> → <a class="idref" href="Sub.html#tm"><span class="id" type="inductive">tm</span></a><br/>
&nbsp;&nbsp;| <a name="ttrue"><span class="id" type="constructor">ttrue</span></a> : <a class="idref" href="Sub.html#tm"><span class="id" type="inductive">tm</span></a><br/>
&nbsp;&nbsp;| <a name="tfalse"><span class="id" type="constructor">tfalse</span></a> : <a class="idref" href="Sub.html#tm"><span class="id" type="inductive">tm</span></a><br/>
&nbsp;&nbsp;| <a name="tif"><span class="id" type="constructor">tif</span></a> : <a class="idref" href="Sub.html#tm"><span class="id" type="inductive">tm</span></a> → <a class="idref" href="Sub.html#tm"><span class="id" type="inductive">tm</span></a> → <a class="idref" href="Sub.html#tm"><span class="id" type="inductive">tm</span></a> → <a class="idref" href="Sub.html#tm"><span class="id" type="inductive">tm</span></a><br/>
&nbsp;&nbsp;| <a name="tunit"><span class="id" type="constructor">tunit</span></a> : <a class="idref" href="Sub.html#tm"><span class="id" type="inductive">tm</span></a> <br/>
.<br/>

<br/>
<span class="id" type="keyword">Tactic Notation</span> "t_cases" <span class="id" type="var">tactic</span>(<span class="id" type="tactic">first</span>) <span class="id" type="var">ident</span>(<span class="id" type="var">c</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="tactic">first</span>;<br/>
&nbsp;&nbsp;[ <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "tvar" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "tapp" <br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "tabs" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ttrue" <br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "tfalse" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "tif"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "tunit" <br/>
&nbsp;&nbsp;].<br/>

<br/>
</div>

<div class="doc">
<a name="lab796"></a><h3 class="section">Substitution</h3>

<div class="paragraph"> </div>

 The definition of substitution remains exactly the same as for the
    pure STLC. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="subst"><span class="id" type="definition">subst</span></a> (<span class="id" type="var">x</span>:<a class="idref" href="SfLib.html#id"><span class="id" type="inductive">id</span></a>) (<span class="id" type="var">s</span>:<a class="idref" href="Sub.html#tm"><span class="id" type="inductive">tm</span></a>)  (<span class="id" type="var">t</span>:<a class="idref" href="Sub.html#tm"><span class="id" type="inductive">tm</span></a>) : <a class="idref" href="Sub.html#tm"><span class="id" type="inductive">tm</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <a class="idref" href="Sub.html#t"><span class="id" type="variable">t</span></a> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Sub.html#tvar"><span class="id" type="constructor">tvar</span></a> <span class="id" type="var">y</span> ⇒ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <a class="idref" href="SfLib.html#eq_id_dec"><span class="id" type="lemma">eq_id_dec</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <span class="id" type="var">y</span> <span class="id" type="keyword">then</span> <a class="idref" href="Sub.html#s"><span class="id" type="variable">s</span></a> <span class="id" type="keyword">else</span> <a class="idref" href="Sub.html#t"><span class="id" type="variable">t</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Sub.html#tabs"><span class="id" type="constructor">tabs</span></a> <span class="id" type="var">y</span> <span class="id" type="var">T</span> <span class="id" type="var">t1</span> ⇒ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#tabs"><span class="id" type="constructor">tabs</span></a> <span class="id" type="var">y</span> <span class="id" type="var">T</span> (<span class="id" type="keyword">if</span> <a class="idref" href="SfLib.html#eq_id_dec"><span class="id" type="lemma">eq_id_dec</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <span class="id" type="var">y</span> <span class="id" type="keyword">then</span> <span class="id" type="var">t1</span> <span class="id" type="keyword">else</span> (<a class="idref" href="Sub.html#subst"><span class="id" type="definition">subst</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="Sub.html#s"><span class="id" type="variable">s</span></a> <span class="id" type="var">t1</span>))<br/>
&nbsp;&nbsp;| <a class="idref" href="Sub.html#tapp"><span class="id" type="constructor">tapp</span></a> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> ⇒ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#tapp"><span class="id" type="constructor">tapp</span></a> (<a class="idref" href="Sub.html#subst"><span class="id" type="definition">subst</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="Sub.html#s"><span class="id" type="variable">s</span></a> <span class="id" type="var">t1</span>) (<a class="idref" href="Sub.html#subst"><span class="id" type="definition">subst</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="Sub.html#s"><span class="id" type="variable">s</span></a> <span class="id" type="var">t2</span>)<br/>
&nbsp;&nbsp;| <a class="idref" href="Sub.html#ttrue"><span class="id" type="constructor">ttrue</span></a> ⇒ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#ttrue"><span class="id" type="constructor">ttrue</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Sub.html#tfalse"><span class="id" type="constructor">tfalse</span></a> ⇒ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#tfalse"><span class="id" type="constructor">tfalse</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Sub.html#tif"><span class="id" type="constructor">tif</span></a> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span> ⇒ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#tif"><span class="id" type="constructor">tif</span></a> (<a class="idref" href="Sub.html#subst"><span class="id" type="definition">subst</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="Sub.html#s"><span class="id" type="variable">s</span></a> <span class="id" type="var">t1</span>) (<a class="idref" href="Sub.html#subst"><span class="id" type="definition">subst</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="Sub.html#s"><span class="id" type="variable">s</span></a> <span class="id" type="var">t2</span>) (<a class="idref" href="Sub.html#subst"><span class="id" type="definition">subst</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="Sub.html#s"><span class="id" type="variable">s</span></a> <span class="id" type="var">t3</span>)<br/>
&nbsp;&nbsp;| <a class="idref" href="Sub.html#tunit"><span class="id" type="constructor">tunit</span></a> ⇒ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#tunit"><span class="id" type="constructor">tunit</span></a> <br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Notation</span> <a name="::'['_x_':='_x_']'_x"><span class="id" type="notation">"</span></a>'[' x ':=' s ']' t" := (<a class="idref" href="Sub.html#subst"><span class="id" type="definition">subst</span></a> <span class="id" type="var">x</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>) (<span class="id" type="tactic">at</span> <span class="id" type="keyword">level</span> 20).<br/>

<br/>
</div>

<div class="doc">
<a name="lab797"></a><h3 class="section">Reduction</h3>

<div class="paragraph"> </div>

 Likewise the definitions of the <span class="inlinecode"><a class="idref" href="Norm.html#value"><span class="id" type="inductive">value</span></a></span> property and the <span class="inlinecode"><a class="idref" href="Norm.html#step"><span class="id" type="inductive">step</span></a></span>
    relation. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Inductive</span> <a name="value"><span class="id" type="inductive">value</span></a> : <a class="idref" href="Sub.html#tm"><span class="id" type="inductive">tm</span></a> → <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a name="v_abs"><span class="id" type="constructor">v_abs</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">x</span> <span class="id" type="var">T</span> <span class="id" type="var">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#value"><span class="id" type="inductive">value</span></a> (<a class="idref" href="Sub.html#tabs"><span class="id" type="constructor">tabs</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a> <a class="idref" href="Sub.html#t"><span class="id" type="variable">t</span></a>)<br/>
&nbsp;&nbsp;| <a name="v_true"><span class="id" type="constructor">v_true</span></a> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#value"><span class="id" type="inductive">value</span></a> <a class="idref" href="Sub.html#ttrue"><span class="id" type="constructor">ttrue</span></a><br/>
&nbsp;&nbsp;| <a name="v_false"><span class="id" type="constructor">v_false</span></a> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#value"><span class="id" type="inductive">value</span></a> <a class="idref" href="Sub.html#tfalse"><span class="id" type="constructor">tfalse</span></a><br/>
&nbsp;&nbsp;| <a name="v_unit"><span class="id" type="constructor">v_unit</span></a> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#value"><span class="id" type="inductive">value</span></a> <a class="idref" href="Sub.html#tunit"><span class="id" type="constructor">tunit</span></a><br/>
.<br/>

<br/>
<span class="id" type="keyword">Hint Constructors</span> <a class="idref" href="Sub.html#value"><span class="id" type="inductive">value</span></a>.<br/>

<br/>
<span class="id" type="keyword">Reserved Notation</span> "t1 '==&gt;' t2" (<span class="id" type="tactic">at</span> <span class="id" type="keyword">level</span> 40).<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <a name="step"><span class="id" type="inductive">step</span></a> : <a class="idref" href="Sub.html#tm"><span class="id" type="inductive">tm</span></a> → <a class="idref" href="Sub.html#tm"><span class="id" type="inductive">tm</span></a> → <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a name="ST_AppAbs"><span class="id" type="constructor">ST_AppAbs</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">x</span> <span class="id" type="var">T</span> <span class="id" type="var">t12</span> <span class="id" type="var">v2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#value"><span class="id" type="inductive">value</span></a> <a class="idref" href="Sub.html#v2"><span class="id" type="variable">v2</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#::x_'==>'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#tapp"><span class="id" type="constructor">tapp</span></a> (<a class="idref" href="Sub.html#tabs"><span class="id" type="constructor">tabs</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a> <a class="idref" href="Sub.html#t12"><span class="id" type="variable">t12</span></a>) <a class="idref" href="Sub.html#v2"><span class="id" type="variable">v2</span></a><a class="idref" href="Sub.html#::x_'==>'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="Sub.html#::x_'==>'_x"><span class="id" type="notation">==&gt;</span></a> <a class="idref" href="Sub.html#::'['_x_':='_x_']'_x"><span class="id" type="notation">[</span></a><a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a><a class="idref" href="Sub.html#::'['_x_':='_x_']'_x"><span class="id" type="notation">:=</span></a><a class="idref" href="Sub.html#v2"><span class="id" type="variable">v2</span></a><a class="idref" href="Sub.html#::'['_x_':='_x_']'_x"><span class="id" type="notation">]</span></a><a class="idref" href="Sub.html#t12"><span class="id" type="variable">t12</span></a><br/>
&nbsp;&nbsp;| <a name="ST_App1"><span class="id" type="constructor">ST_App1</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">t1</span> <span class="id" type="var">t1'</span> <span class="id" type="var">t2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#t1"><span class="id" type="variable">t1</span></a> <a class="idref" href="Sub.html#::x_'==>'_x"><span class="id" type="notation">==&gt;</span></a> <a class="idref" href="Sub.html#t1'"><span class="id" type="variable">t1'</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#::x_'==>'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#tapp"><span class="id" type="constructor">tapp</span></a> <a class="idref" href="Sub.html#t1"><span class="id" type="variable">t1</span></a> <a class="idref" href="Sub.html#t2"><span class="id" type="variable">t2</span></a><a class="idref" href="Sub.html#::x_'==>'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="Sub.html#::x_'==>'_x"><span class="id" type="notation">==&gt;</span></a> <a class="idref" href="Sub.html#::x_'==>'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#tapp"><span class="id" type="constructor">tapp</span></a> <a class="idref" href="Sub.html#t1'"><span class="id" type="variable">t1'</span></a> <a class="idref" href="Sub.html#t2"><span class="id" type="variable">t2</span></a><a class="idref" href="Sub.html#::x_'==>'_x"><span class="id" type="notation">)</span></a><br/>
&nbsp;&nbsp;| <a name="ST_App2"><span class="id" type="constructor">ST_App2</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">v1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t2'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#value"><span class="id" type="inductive">value</span></a> <a class="idref" href="Sub.html#v1"><span class="id" type="variable">v1</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#t2"><span class="id" type="variable">t2</span></a> <a class="idref" href="Sub.html#::x_'==>'_x"><span class="id" type="notation">==&gt;</span></a> <a class="idref" href="Sub.html#t2'"><span class="id" type="variable">t2'</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#::x_'==>'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#tapp"><span class="id" type="constructor">tapp</span></a> <a class="idref" href="Sub.html#v1"><span class="id" type="variable">v1</span></a> <a class="idref" href="Sub.html#t2"><span class="id" type="variable">t2</span></a><a class="idref" href="Sub.html#::x_'==>'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="Sub.html#::x_'==>'_x"><span class="id" type="notation">==&gt;</span></a> <a class="idref" href="Sub.html#::x_'==>'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#tapp"><span class="id" type="constructor">tapp</span></a> <a class="idref" href="Sub.html#v1"><span class="id" type="variable">v1</span></a>  <a class="idref" href="Sub.html#t2'"><span class="id" type="variable">t2'</span></a><a class="idref" href="Sub.html#::x_'==>'_x"><span class="id" type="notation">)</span></a><br/>
&nbsp;&nbsp;| <a name="ST_IfTrue"><span class="id" type="constructor">ST_IfTrue</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#::x_'==>'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#tif"><span class="id" type="constructor">tif</span></a> <a class="idref" href="Sub.html#ttrue"><span class="id" type="constructor">ttrue</span></a> <a class="idref" href="Sub.html#t1"><span class="id" type="variable">t1</span></a> <a class="idref" href="Sub.html#t2"><span class="id" type="variable">t2</span></a><a class="idref" href="Sub.html#::x_'==>'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="Sub.html#::x_'==>'_x"><span class="id" type="notation">==&gt;</span></a> <a class="idref" href="Sub.html#t1"><span class="id" type="variable">t1</span></a><br/>
&nbsp;&nbsp;| <a name="ST_IfFalse"><span class="id" type="constructor">ST_IfFalse</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#::x_'==>'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#tif"><span class="id" type="constructor">tif</span></a> <a class="idref" href="Sub.html#tfalse"><span class="id" type="constructor">tfalse</span></a> <a class="idref" href="Sub.html#t1"><span class="id" type="variable">t1</span></a> <a class="idref" href="Sub.html#t2"><span class="id" type="variable">t2</span></a><a class="idref" href="Sub.html#::x_'==>'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="Sub.html#::x_'==>'_x"><span class="id" type="notation">==&gt;</span></a> <a class="idref" href="Sub.html#t2"><span class="id" type="variable">t2</span></a><br/>
&nbsp;&nbsp;| <a name="ST_If"><span class="id" type="constructor">ST_If</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">t1</span> <span class="id" type="var">t1'</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#t1"><span class="id" type="variable">t1</span></a> <a class="idref" href="Sub.html#::x_'==>'_x"><span class="id" type="notation">==&gt;</span></a> <a class="idref" href="Sub.html#t1'"><span class="id" type="variable">t1'</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#::x_'==>'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#tif"><span class="id" type="constructor">tif</span></a> <a class="idref" href="Sub.html#t1"><span class="id" type="variable">t1</span></a> <a class="idref" href="Sub.html#t2"><span class="id" type="variable">t2</span></a> <a class="idref" href="Sub.html#t3"><span class="id" type="variable">t3</span></a><a class="idref" href="Sub.html#::x_'==>'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="Sub.html#::x_'==>'_x"><span class="id" type="notation">==&gt;</span></a> <a class="idref" href="Sub.html#::x_'==>'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#tif"><span class="id" type="constructor">tif</span></a> <a class="idref" href="Sub.html#t1'"><span class="id" type="variable">t1'</span></a> <a class="idref" href="Sub.html#t2"><span class="id" type="variable">t2</span></a> <a class="idref" href="Sub.html#t3"><span class="id" type="variable">t3</span></a><a class="idref" href="Sub.html#::x_'==>'_x"><span class="id" type="notation">)</span></a><br/>
<span class="id" type="keyword">where</span> <a name="::x_'==>'_x"><span class="id" type="notation">"</span></a>t1 '==&gt;' t2" := (<a class="idref" href="Sub.html#step"><span class="id" type="inductive">step</span></a> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>).<br/>

<br/>
<span class="id" type="keyword">Tactic Notation</span> "step_cases" <span class="id" type="var">tactic</span>(<span class="id" type="tactic">first</span>) <span class="id" type="var">ident</span>(<span class="id" type="var">c</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="tactic">first</span>;<br/>
&nbsp;&nbsp;[ <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ST_AppAbs" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ST_App1" <br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ST_App2" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ST_IfTrue" <br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ST_IfFalse" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ST_If"  <br/>
&nbsp;&nbsp;].<br/>

<br/>
<span class="id" type="keyword">Hint Constructors</span> <a class="idref" href="Sub.html#step"><span class="id" type="inductive">step</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab798"></a><h2 class="section">Subtyping</h2>

<div class="paragraph"> </div>

 Now we come to the most interesting part.  We begin by
    defining the subtyping relation and developing some of its
    important technical properties. 
<div class="paragraph"> </div>

 The definition of subtyping is just what we sketched in the
    motivating discussion. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Reserved Notation</span> "T '&lt;:' U" (<span class="id" type="tactic">at</span> <span class="id" type="keyword">level</span> 40).<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <a name="subtype"><span class="id" type="inductive">subtype</span></a> : <a class="idref" href="Sub.html#ty"><span class="id" type="inductive">ty</span></a> → <a class="idref" href="Sub.html#ty"><span class="id" type="inductive">ty</span></a> → <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a name="S_Refl"><span class="id" type="constructor">S_Refl</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">T</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">&lt;:</span></a> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a><br/>
&nbsp;&nbsp;| <a name="S_Trans"><span class="id" type="constructor">S_Trans</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">S</span> <span class="id" type="var">U</span> <span class="id" type="var">T</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#S"><span class="id" type="variable">S</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">&lt;:</span></a> <a class="idref" href="Sub.html#U"><span class="id" type="variable">U</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#U"><span class="id" type="variable">U</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">&lt;:</span></a> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#S"><span class="id" type="variable">S</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">&lt;:</span></a> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a><br/>
&nbsp;&nbsp;| <a name="S_Top"><span class="id" type="constructor">S_Top</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">S</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#S"><span class="id" type="variable">S</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">&lt;:</span></a> <a class="idref" href="Sub.html#TTop"><span class="id" type="constructor">TTop</span></a><br/>
&nbsp;&nbsp;| <a name="S_Arrow"><span class="id" type="constructor">S_Arrow</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">S1</span> <span class="id" type="var">S2</span> <span class="id" type="var">T1</span> <span class="id" type="var">T2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#T1"><span class="id" type="variable">T1</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">&lt;:</span></a> <a class="idref" href="Sub.html#S1"><span class="id" type="variable">S1</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#S2"><span class="id" type="variable">S2</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">&lt;:</span></a> <a class="idref" href="Sub.html#T2"><span class="id" type="variable">T2</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#TArrow"><span class="id" type="constructor">TArrow</span></a> <a class="idref" href="Sub.html#S1"><span class="id" type="variable">S1</span></a> <a class="idref" href="Sub.html#S2"><span class="id" type="variable">S2</span></a><a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">&lt;:</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#TArrow"><span class="id" type="constructor">TArrow</span></a> <a class="idref" href="Sub.html#T1"><span class="id" type="variable">T1</span></a> <a class="idref" href="Sub.html#T2"><span class="id" type="variable">T2</span></a><a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">)</span></a><br/>
<span class="id" type="keyword">where</span> <a name="::x_'<:'_x"><span class="id" type="notation">"</span></a>T '&lt;:' U" := (<a class="idref" href="Sub.html#subtype"><span class="id" type="inductive">subtype</span></a> <span class="id" type="var">T</span> <span class="id" type="var">U</span>).<br/>

<br/>
</div>

<div class="doc">
Note that we don't need any special rules for base types: they are
    automatically subtypes of themselves (by <span class="inlinecode"><a class="idref" href="RecordSub.html#S_Refl"><span class="id" type="constructor">S_Refl</span></a></span>) and <span class="inlinecode"><span class="id" type="var">Top</span></span> (by
    <span class="inlinecode"><a class="idref" href="RecordSub.html#S_Top"><span class="id" type="constructor">S_Top</span></a></span>), and that's all we want. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Hint Constructors</span> <a class="idref" href="Sub.html#subtype"><span class="id" type="inductive">subtype</span></a>.<br/>

<br/>
<span class="id" type="keyword">Tactic Notation</span> "subtype_cases" <span class="id" type="var">tactic</span>(<span class="id" type="tactic">first</span>) <span class="id" type="var">ident</span>(<span class="id" type="var">c</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="tactic">first</span>;<br/>
&nbsp;&nbsp;[ <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "S_Refl" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "S_Trans"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "S_Top" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "S_Arrow" <br/>
&nbsp;&nbsp;].<br/>

<br/>
<span class="id" type="keyword">Module</span> <a name="Examples"><span class="id" type="module">Examples</span></a>.<br/>

<br/>
<span class="id" type="keyword">Notation</span> <a name="Examples.x"><span class="id" type="abbreviation">x</span></a> := (<a class="idref" href="SfLib.html#Id"><span class="id" type="constructor">Id</span></a> 0).<br/>
<span class="id" type="keyword">Notation</span> <a name="Examples.y"><span class="id" type="abbreviation">y</span></a> := (<a class="idref" href="SfLib.html#Id"><span class="id" type="constructor">Id</span></a> 1).<br/>
<span class="id" type="keyword">Notation</span> <a name="Examples.z"><span class="id" type="abbreviation">z</span></a> := (<a class="idref" href="SfLib.html#Id"><span class="id" type="constructor">Id</span></a> 2).<br/>

<br/>
<span class="id" type="keyword">Notation</span> <a name="Examples.A"><span class="id" type="abbreviation">A</span></a> := (<a class="idref" href="Sub.html#Examples.TBase"><span class="id" type="constructor">TBase</span></a> (<a class="idref" href="SfLib.html#Id"><span class="id" type="constructor">Id</span></a> 6)).<br/>
<span class="id" type="keyword">Notation</span> <a name="Examples.B"><span class="id" type="abbreviation">B</span></a> := (<a class="idref" href="Sub.html#Examples.TBase"><span class="id" type="constructor">TBase</span></a> (<a class="idref" href="SfLib.html#Id"><span class="id" type="constructor">Id</span></a> 7)).<br/>
<span class="id" type="keyword">Notation</span> <a name="Examples.C"><span class="id" type="abbreviation">C</span></a> := (<a class="idref" href="Sub.html#Examples.TBase"><span class="id" type="constructor">TBase</span></a> (<a class="idref" href="SfLib.html#Id"><span class="id" type="constructor">Id</span></a> 8)).<br/>

<br/>
<span class="id" type="keyword">Notation</span> <a name="Examples.String"><span class="id" type="abbreviation">String</span></a> := (<a class="idref" href="Sub.html#Examples.TBase"><span class="id" type="constructor">TBase</span></a> (<a class="idref" href="SfLib.html#Id"><span class="id" type="constructor">Id</span></a> 9)).<br/>
<span class="id" type="keyword">Notation</span> <a name="Examples.Float"><span class="id" type="abbreviation">Float</span></a> := (<a class="idref" href="Sub.html#Examples.TBase"><span class="id" type="constructor">TBase</span></a> (<a class="idref" href="SfLib.html#Id"><span class="id" type="constructor">Id</span></a> 10)).<br/>
<span class="id" type="keyword">Notation</span> <a name="Examples.Integer"><span class="id" type="abbreviation">Integer</span></a> := (<a class="idref" href="Sub.html#Examples.TBase"><span class="id" type="constructor">TBase</span></a> (<a class="idref" href="SfLib.html#Id"><span class="id" type="constructor">Id</span></a> 11)).<br/>

<br/>
</div>

<div class="doc">
<a name="lab799"></a><h4 class="section">Exercise: 2 stars, optional (subtyping_judgements)</h4>

<div class="paragraph"> </div>

 (Do this exercise after you have added product types to the
    language, at least up to this point in the file).

<div class="paragraph"> </div>

    Using the encoding of records into pairs, define pair types
    representing the record types
    Person   := { name : String }
    Student  := { name : String ; 
                  gpa  : Float }
    Employee := { name : String ;
                  ssn  : Integer }

<div class="paragraph"> </div>

Recall that in chapter MoreStlc, the optional subsection "Encoding
Records" describes how records can be encoded as pairs.

<div class="paragraph"> </div>


</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <a name="Examples.Person"><span class="id" type="definition">Person</span></a> : <a class="idref" href="Sub.html#Examples.ty"><span class="id" type="inductive">ty</span></a> := <br/>
 <a class="idref" href="SfLib.html#admit"><span class="id" type="axiom">admit</span></a>.<br/>
<span class="id" type="keyword">Definition</span> <a name="Examples.Student"><span class="id" type="definition">Student</span></a> : <a class="idref" href="Sub.html#Examples.ty"><span class="id" type="inductive">ty</span></a> := <br/>
 <a class="idref" href="SfLib.html#admit"><span class="id" type="axiom">admit</span></a>.<br/>
<span class="id" type="keyword">Definition</span> <a name="Examples.Employee"><span class="id" type="definition">Employee</span></a> : <a class="idref" href="Sub.html#Examples.ty"><span class="id" type="inductive">ty</span></a> := <br/>
 <a class="idref" href="SfLib.html#admit"><span class="id" type="axiom">admit</span></a>.<br/>

<br/>
<span class="id" type="keyword">Example</span> <a name="Examples.sub_student_person"><span class="id" type="definition">sub_student_person</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Sub.html#Examples.Student"><span class="id" type="definition">Student</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">&lt;:</span></a> <a class="idref" href="Sub.html#Examples.Person"><span class="id" type="definition">Person</span></a>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
 <span class="id" type="var">Admitted</span>.<br/>

<br/>
<span class="id" type="keyword">Example</span> <a name="Examples.sub_employee_person"><span class="id" type="definition">sub_employee_person</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Sub.html#Examples.Employee"><span class="id" type="definition">Employee</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">&lt;:</span></a> <a class="idref" href="Sub.html#Examples.Person"><span class="id" type="definition">Person</span></a>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
 <span class="id" type="var">Admitted</span>.<br/>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Example</span> <a name="Examples.subtyping_example_0"><span class="id" type="definition">subtyping_example_0</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#Examples.TArrow"><span class="id" type="constructor">TArrow</span></a> <a class="idref" href="Sub.html#Examples.C"><span class="id" type="abbreviation">C</span></a> <a class="idref" href="Sub.html#Examples.Person"><span class="id" type="definition">Person</span></a><a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">&lt;:</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#Examples.TArrow"><span class="id" type="constructor">TArrow</span></a> <a class="idref" href="Sub.html#Examples.C"><span class="id" type="abbreviation">C</span></a> <a class="idref" href="Sub.html#Examples.TTop"><span class="id" type="constructor">TTop</span></a><a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">)</span></a>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="Sub.html#Examples.S_Arrow"><span class="id" type="constructor">S_Arrow</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="Sub.html#Examples.S_Refl"><span class="id" type="constructor">S_Refl</span></a>. <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The following facts are mostly easy to prove in Coq.  To get
    full benefit from the exercises, make sure you also
    understand how to prove them on paper! 
<div class="paragraph"> </div>

<a name="lab800"></a><h4 class="section">Exercise: 1 star, optional (subtyping_example_1)</h4>

</div>
<div class="code">
<span class="id" type="keyword">Example</span> <a name="Examples.subtyping_example_1"><span class="id" type="definition">subtyping_example_1</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#Examples.TArrow"><span class="id" type="constructor">TArrow</span></a> <a class="idref" href="Sub.html#Examples.TTop"><span class="id" type="constructor">TTop</span></a> <a class="idref" href="Sub.html#Examples.Student"><span class="id" type="definition">Student</span></a><a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">&lt;:</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#Examples.TArrow"><span class="id" type="constructor">TArrow</span></a> (<a class="idref" href="Sub.html#Examples.TArrow"><span class="id" type="constructor">TArrow</span></a> <a class="idref" href="Sub.html#Examples.C"><span class="id" type="abbreviation">C</span></a> <a class="idref" href="Sub.html#Examples.C"><span class="id" type="abbreviation">C</span></a>) <a class="idref" href="Sub.html#Examples.Person"><span class="id" type="definition">Person</span></a><a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">)</span></a>.<br/>
<span class="id" type="keyword">Proof</span> <span class="id" type="keyword">with</span> <span class="id" type="tactic">eauto</span>.<br/>
 <span class="id" type="var">Admitted</span>.<br/>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

<a name="lab801"></a><h4 class="section">Exercise: 1 star, optional (subtyping_example_2)</h4>

</div>
<div class="code">
<span class="id" type="keyword">Example</span> <a name="Examples.subtyping_example_2"><span class="id" type="definition">subtyping_example_2</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#Examples.TArrow"><span class="id" type="constructor">TArrow</span></a> <a class="idref" href="Sub.html#Examples.TTop"><span class="id" type="constructor">TTop</span></a> <a class="idref" href="Sub.html#Examples.Person"><span class="id" type="definition">Person</span></a><a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">&lt;:</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#Examples.TArrow"><span class="id" type="constructor">TArrow</span></a> <a class="idref" href="Sub.html#Examples.Person"><span class="id" type="definition">Person</span></a> <a class="idref" href="Sub.html#Examples.TTop"><span class="id" type="constructor">TTop</span></a><a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">)</span></a>.<br/>
<span class="id" type="keyword">Proof</span> <span class="id" type="keyword">with</span> <span class="id" type="tactic">eauto</span>.<br/>
 <span class="id" type="var">Admitted</span>.<br/>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">End</span> <a class="idref" href="Sub.html#Examples"><span class="id" type="module">Examples</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab802"></a><h2 class="section">Typing</h2>

<div class="paragraph"> </div>

 The only change to the typing relation is the addition of the rule
    of subsumption, <span class="inlinecode"><a class="idref" href="RecordSub.html#T_Sub"><span class="id" type="constructor">T_Sub</span></a></span>. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="keyword">context</span> := <a class="idref" href="SfLib.html#id"><span class="id" type="inductive">id</span></a> → (<a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#option"><span class="id" type="inductive">option</span></a> <a class="idref" href="Sub.html#ty"><span class="id" type="inductive">ty</span></a>).<br/>
<span class="id" type="keyword">Definition</span> <a name="empty"><span class="id" type="definition">empty</span></a> : <span class="id" type="keyword">context</span> := (<span class="id" type="keyword">fun</span> <span class="id" type="var">_</span> ⇒ <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#None"><span class="id" type="constructor">None</span></a>).<br/>
<span class="id" type="keyword">Definition</span> <a name="extend"><span class="id" type="definition">extend</span></a> (<span class="id" type="var">Gamma</span> : <span class="id" type="keyword">context</span>) (<span class="id" type="var">x</span>:<a class="idref" href="SfLib.html#id"><span class="id" type="inductive">id</span></a>) (<span class="id" type="var">T</span> : <a class="idref" href="Sub.html#ty"><span class="id" type="inductive">ty</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">fun</span> <span class="id" type="var">x'</span> ⇒ <span class="id" type="keyword">if</span> <a class="idref" href="SfLib.html#eq_id_dec"><span class="id" type="lemma">eq_id_dec</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="Sub.html#x'"><span class="id" type="variable">x'</span></a> <span class="id" type="keyword">then</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#Some"><span class="id" type="constructor">Some</span></a> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a> <span class="id" type="keyword">else</span> <a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#x'"><span class="id" type="variable">x'</span></a>.<br/>

<br/>
<span class="id" type="keyword">Reserved Notation</span> "Gamma '|-' t '\in' T" (<span class="id" type="tactic">at</span> <span class="id" type="keyword">level</span> 40).<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <a name="has_type"><span class="id" type="inductive">has_type</span></a> : <span class="id" type="keyword">context</span> → <a class="idref" href="Sub.html#tm"><span class="id" type="inductive">tm</span></a> → <a class="idref" href="Sub.html#ty"><span class="id" type="inductive">ty</span></a> → <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <a name="T_Var"><span class="id" type="constructor">T_Var</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">Gamma</span> <span class="id" type="var">x</span> <span class="id" type="var">T</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'='_x"><span class="id" type="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#Some"><span class="id" type="constructor">Some</span></a> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#tvar"><span class="id" type="constructor">tvar</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a><a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a><br/>
&nbsp;&nbsp;| <a name="T_Abs"><span class="id" type="constructor">T_Abs</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">Gamma</span> <span class="id" type="var">x</span> <span class="id" type="var">T11</span> <span class="id" type="var">T12</span> <span class="id" type="var">t12</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#extend"><span class="id" type="definition">extend</span></a> <a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="Sub.html#T11"><span class="id" type="variable">T11</span></a><a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#t12"><span class="id" type="variable">t12</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#T12"><span class="id" type="variable">T12</span></a> → <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#tabs"><span class="id" type="constructor">tabs</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="Sub.html#T11"><span class="id" type="variable">T11</span></a> <a class="idref" href="Sub.html#t12"><span class="id" type="variable">t12</span></a><a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#TArrow"><span class="id" type="constructor">TArrow</span></a> <a class="idref" href="Sub.html#T11"><span class="id" type="variable">T11</span></a> <a class="idref" href="Sub.html#T12"><span class="id" type="variable">T12</span></a><a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">)</span></a><br/>
&nbsp;&nbsp;| <a name="T_App"><span class="id" type="constructor">T_App</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">T1</span> <span class="id" type="var">T2</span> <span class="id" type="var">Gamma</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#t1"><span class="id" type="variable">t1</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#TArrow"><span class="id" type="constructor">TArrow</span></a> <a class="idref" href="Sub.html#T1"><span class="id" type="variable">T1</span></a> <a class="idref" href="Sub.html#T2"><span class="id" type="variable">T2</span></a><a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">)</span></a> → <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#t2"><span class="id" type="variable">t2</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#T1"><span class="id" type="variable">T1</span></a> → <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#tapp"><span class="id" type="constructor">tapp</span></a> <a class="idref" href="Sub.html#t1"><span class="id" type="variable">t1</span></a> <a class="idref" href="Sub.html#t2"><span class="id" type="variable">t2</span></a><a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#T2"><span class="id" type="variable">T2</span></a><br/>
&nbsp;&nbsp;| <a name="T_True"><span class="id" type="constructor">T_True</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">Gamma</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#ttrue"><span class="id" type="constructor">ttrue</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#TBool"><span class="id" type="constructor">TBool</span></a><br/>
&nbsp;&nbsp;| <a name="T_False"><span class="id" type="constructor">T_False</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">Gamma</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#tfalse"><span class="id" type="constructor">tfalse</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#TBool"><span class="id" type="constructor">TBool</span></a><br/>
&nbsp;&nbsp;| <a name="T_If"><span class="id" type="constructor">T_If</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span> <span class="id" type="var">T</span> <span class="id" type="var">Gamma</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#t1"><span class="id" type="variable">t1</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#TBool"><span class="id" type="constructor">TBool</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#t2"><span class="id" type="variable">t2</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#t3"><span class="id" type="variable">t3</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#tif"><span class="id" type="constructor">tif</span></a> <a class="idref" href="Sub.html#t1"><span class="id" type="variable">t1</span></a> <a class="idref" href="Sub.html#t2"><span class="id" type="variable">t2</span></a> <a class="idref" href="Sub.html#t3"><span class="id" type="variable">t3</span></a><a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a><br/>
&nbsp;&nbsp;| <a name="T_Unit"><span class="id" type="constructor">T_Unit</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">Gamma</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#tunit"><span class="id" type="constructor">tunit</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#TUnit"><span class="id" type="constructor">TUnit</span></a><br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <a name="T_Sub"><span class="id" type="constructor">T_Sub</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">Gamma</span> <span class="id" type="var">t</span> <span class="id" type="var">S</span> <span class="id" type="var">T</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#t"><span class="id" type="variable">t</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#S"><span class="id" type="variable">S</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#S"><span class="id" type="variable">S</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">&lt;:</span></a> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#t"><span class="id" type="variable">t</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a><br/>
<br/>
<span class="id" type="keyword">where</span> <a name="::x_'|-'_x_'\in'_x"><span class="id" type="notation">"</span></a>Gamma '|-' t '\in' T" := (<a class="idref" href="Sub.html#has_type"><span class="id" type="inductive">has_type</span></a> <span class="id" type="var">Gamma</span> <span class="id" type="var">t</span> <span class="id" type="var">T</span>).<br/>

<br/>
<span class="id" type="keyword">Hint Constructors</span> <a class="idref" href="Sub.html#has_type"><span class="id" type="inductive">has_type</span></a>.<br/>

<br/>
<span class="id" type="keyword">Tactic Notation</span> "has_type_cases" <span class="id" type="var">tactic</span>(<span class="id" type="tactic">first</span>) <span class="id" type="var">ident</span>(<span class="id" type="var">c</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="tactic">first</span>;<br/>
&nbsp;&nbsp;[ <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "T_Var" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "T_Abs" <br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "T_App" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "T_True" <br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "T_False" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "T_If"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "T_Unit"     <br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "T_Sub" ].<br/>

<br/>
<span class="id" type="keyword">Hint Extern</span> 2 (<a class="idref" href="Sub.html#has_type"><span class="id" type="inductive">has_type</span></a> <span class="id" type="var">_</span> (<a class="idref" href="Sub.html#tapp"><span class="id" type="constructor">tapp</span></a> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) <span class="id" type="var">_</span>) ⇒ <br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <a class="idref" href="Sub.html#T_App"><span class="id" type="constructor">T_App</span></a>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="keyword">Hint Extern</span> 2 (<span class="id" type="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'='_x"><span class="id" type="notation">=</span></a> <span class="id" type="var">_</span>) ⇒ <span class="id" type="tactic">compute</span>; <span class="id" type="tactic">reflexivity</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab803"></a><h2 class="section">Typing examples</h2>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Module</span> <a name="Examples2"><span class="id" type="module">Examples2</span></a>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">Examples</span>.<br/>

<br/>
</div>

<div class="doc">
Do the following exercises after you have added product types to
    the language.  For each informal typing judgement, write it as a
    formal statement in Coq and prove it. 
<div class="paragraph"> </div>

<a name="lab804"></a><h4 class="section">Exercise: 1 star, optional (typing_example_0)</h4>

</div>
<div class="code">
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

<a name="lab805"></a><h4 class="section">Exercise: 2 stars, optional (typing_example_1)</h4>

</div>
<div class="code">
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

<a name="lab806"></a><h4 class="section">Exercise: 2 stars, optional (typing_example_2)</h4>

</div>
<div class="code">
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">End</span> <a class="idref" href="Sub.html#Examples2"><span class="id" type="module">Examples2</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab807"></a><h1 class="section">Properties</h1>

<div class="paragraph"> </div>

 The fundamental properties of the system that we want to check are
    the same as always: progress and preservation.  Unlike the
    extension of the STLC with references, we don't need to change the
    <i>statements</i> of these properties to take subtyping into account.
    However, their proofs do become a little bit more involved. 
</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a name="lab808"></a><h2 class="section">Inversion Lemmas for Subtyping</h2>

<div class="paragraph"> </div>

 Before we look at the properties of the typing relation, we need
    to record a couple of critical structural properties of the subtype
    relation: 

<div class="paragraph"> </div>

<ul class="doclist">
<li> <span class="inlinecode"><span class="id" type="library">Bool</span></span> is the only subtype of <span class="inlinecode"><span class="id" type="library">Bool</span></span>

</li>
<li> every subtype of an arrow type is itself an arrow type. 
</li>
</ul>

<div class="paragraph"> </div>

 These are called <i>inversion lemmas</i> because they play the same
    role in later proofs as the built-in <span class="inlinecode"><span class="id" type="tactic">inversion</span></span> tactic: given a
    hypothesis that there exists a derivation of some subtyping
    statement <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a></span> <span class="inlinecode">&lt;:</span> <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> and some constraints on the shape of <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a></span> and/or
    <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span>, each one reasons about what this derivation must look like to
    tell us something further about the shapes of <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a></span> and <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> and the
    existence of subtype relations between their parts. 
<div class="paragraph"> </div>

<a name="lab809"></a><h4 class="section">Exercise: 2 stars, optional (sub_inversion_Bool)</h4>

</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <a name="sub_inversion_Bool"><span class="id" type="lemma">sub_inversion_Bool</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">U</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#U"><span class="id" type="variable">U</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">&lt;:</span></a> <a class="idref" href="Sub.html#TBool"><span class="id" type="constructor">TBool</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#U"><span class="id" type="variable">U</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'='_x"><span class="id" type="notation">=</span></a> <a class="idref" href="Sub.html#TBool"><span class="id" type="constructor">TBool</span></a>.<br/>
<span class="id" type="keyword">Proof</span> <span class="id" type="keyword">with</span> <span class="id" type="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">U</span> <span class="id" type="var">Hs</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">remember</span> <a class="idref" href="Sub.html#TBool"><span class="id" type="constructor">TBool</span></a> <span class="id" type="keyword">as</span> <span class="id" type="var">V</span>.<br/>
 <span class="id" type="var">Admitted</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab810"></a><h4 class="section">Exercise: 3 stars, optional (sub_inversion_arrow)</h4>

</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <a name="sub_inversion_arrow"><span class="id" type="lemma">sub_inversion_arrow</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">U</span> <span class="id" type="var">V1</span> <span class="id" type="var">V2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#U"><span class="id" type="variable">U</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">&lt;:</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#TArrow"><span class="id" type="constructor">TArrow</span></a> <a class="idref" href="Sub.html#V1"><span class="id" type="variable">V1</span></a> <a class="idref" href="Sub.html#V2"><span class="id" type="variable">V2</span></a><a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">)</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:'exists'_x_'..'_x_','_x"><span class="id" type="notation">∃</span></a> <span class="id" type="var">U1</span><a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:'exists'_x_'..'_x_','_x"><span class="id" type="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:'exists'_x_'..'_x_','_x"><span class="id" type="notation">∃</span></a> <span class="id" type="var">U2</span><a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:'exists'_x_'..'_x_','_x"><span class="id" type="notation">,</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#U"><span class="id" type="variable">U</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'='_x"><span class="id" type="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'='_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#TArrow"><span class="id" type="constructor">TArrow</span></a> <a class="idref" href="Sub.html#U1"><span class="id" type="variable">U1</span></a> <a class="idref" href="Sub.html#U2"><span class="id" type="variable">U2</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'='_x"><span class="id" type="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'/\'_x"><span class="id" type="notation">∧</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'/\'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#V1"><span class="id" type="variable">V1</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">&lt;:</span></a> <a class="idref" href="Sub.html#U1"><span class="id" type="variable">U1</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'/\'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'/\'_x"><span class="id" type="notation">∧</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'/\'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#U2"><span class="id" type="variable">U2</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">&lt;:</span></a> <a class="idref" href="Sub.html#V2"><span class="id" type="variable">V2</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'/\'_x"><span class="id" type="notation">)</span></a>.<br/>
<span class="id" type="keyword">Proof</span> <span class="id" type="keyword">with</span> <span class="id" type="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">U</span> <span class="id" type="var">V1</span> <span class="id" type="var">V2</span> <span class="id" type="var">Hs</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">remember</span> (<a class="idref" href="Sub.html#TArrow"><span class="id" type="constructor">TArrow</span></a> <span class="id" type="var">V1</span> <span class="id" type="var">V2</span>) <span class="id" type="keyword">as</span> <span class="id" type="var">V</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">generalize</span> <span class="id" type="tactic">dependent</span> <span class="id" type="var">V2</span>. <span class="id" type="tactic">generalize</span> <span class="id" type="tactic">dependent</span> <span class="id" type="var">V1</span>.<br/>
 <span class="id" type="var">Admitted</span>.<br/>

<br/>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a name="lab811"></a><h2 class="section">Canonical Forms</h2>

<div class="paragraph"> </div>

 We'll see first that the proof of the progress theorem doesn't
    change too much -- we just need one small refinement.  When we're
    considering the case where the term in question is an application
    <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span> where both <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> and <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span> are values, we need to know that
    <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> has the <i>form</i> of a lambda-abstraction, so that we can apply
    the <span class="inlinecode"><a class="idref" href="Norm.html#ST_AppAbs"><span class="id" type="constructor">ST_AppAbs</span></a></span> reduction rule.  In the ordinary STLC, this is
    obvious: we know that <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> has a function type <span class="inlinecode"><a class="idref" href="Stlc.html#T11"><span class="id" type="variable">T11</span></a>→<a class="idref" href="Stlc.html#T12"><span class="id" type="variable">T12</span></a></span>, and
    there is only one rule that can be used to give a function type to
    a value -- rule <span class="inlinecode"><a class="idref" href="Norm.html#T_Abs"><span class="id" type="constructor">T_Abs</span></a></span> -- and the form of the conclusion of this
    rule forces <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> to be an abstraction.

<div class="paragraph"> </div>

    In the STLC with subtyping, this reasoning doesn't quite work
    because there's another rule that can be used to show that a value
    has a function type: subsumption.  Fortunately, this possibility
    doesn't change things much: if the last rule used to show <span class="inlinecode"><a class="idref" href="SfLib.html#Gamma"><span class="id" type="variable">Gamma</span></a></span>
    <span class="inlinecode">|-</span> <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> <span class="inlinecode">:</span> <span class="inlinecode"><a class="idref" href="Stlc.html#T11"><span class="id" type="variable">T11</span></a>→<a class="idref" href="Stlc.html#T12"><span class="id" type="variable">T12</span></a></span> is subsumption, then there is some
    <i>sub</i>-derivation whose subject is also <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span>, and we can reason by
    induction until we finally bottom out at a use of <span class="inlinecode"><a class="idref" href="Norm.html#T_Abs"><span class="id" type="constructor">T_Abs</span></a></span>.

<div class="paragraph"> </div>

    This bit of reasoning is packaged up in the following lemma, which
    tells us the possible "canonical forms" (i.e. values) of function
    type. 
<div class="paragraph"> </div>

<a name="lab812"></a><h4 class="section">Exercise: 3 stars, optional (canonical_forms_of_arrow_types)</h4>

</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <a name="canonical_forms_of_arrow_types"><span class="id" type="lemma">canonical_forms_of_arrow_types</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">Gamma</span> <span class="id" type="var">s</span> <span class="id" type="var">T1</span> <span class="id" type="var">T2</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#s"><span class="id" type="variable">s</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#TArrow"><span class="id" type="constructor">TArrow</span></a> <a class="idref" href="Sub.html#T1"><span class="id" type="variable">T1</span></a> <a class="idref" href="Sub.html#T2"><span class="id" type="variable">T2</span></a><a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">)</span></a> →<br/>
&nbsp;&nbsp;<a class="idref" href="Sub.html#value"><span class="id" type="inductive">value</span></a> <a class="idref" href="Sub.html#s"><span class="id" type="variable">s</span></a> →<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:'exists'_x_'..'_x_','_x"><span class="id" type="notation">∃</span></a> <span class="id" type="var">x</span><a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:'exists'_x_'..'_x_','_x"><span class="id" type="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:'exists'_x_'..'_x_','_x"><span class="id" type="notation">∃</span></a> <span class="id" type="var">S1</span><a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:'exists'_x_'..'_x_','_x"><span class="id" type="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:'exists'_x_'..'_x_','_x"><span class="id" type="notation">∃</span></a> <span class="id" type="var">s2</span><a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:'exists'_x_'..'_x_','_x"><span class="id" type="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#s"><span class="id" type="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'='_x"><span class="id" type="notation">=</span></a> <a class="idref" href="Sub.html#tabs"><span class="id" type="constructor">tabs</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="Sub.html#S1"><span class="id" type="variable">S1</span></a> <a class="idref" href="Sub.html#s2"><span class="id" type="variable">s2</span></a>.<br/>
<span class="id" type="keyword">Proof</span> <span class="id" type="keyword">with</span> <span class="id" type="tactic">eauto</span>.<br/>
 <span class="id" type="var">Admitted</span>.<br/>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

 Similarly, the canonical forms of type <span class="inlinecode"><span class="id" type="library">Bool</span></span> are the constants
    <span class="inlinecode"><a class="idref" href="Basics.html#true"><span class="id" type="constructor">true</span></a></span> and <span class="inlinecode"><a class="idref" href="Basics.html#false"><span class="id" type="constructor">false</span></a></span>. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <a name="canonical_forms_of_Bool"><span class="id" type="lemma">canonical_forms_of_Bool</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">Gamma</span> <span class="id" type="var">s</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#s"><span class="id" type="variable">s</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#TBool"><span class="id" type="constructor">TBool</span></a> →<br/>
&nbsp;&nbsp;<a class="idref" href="Sub.html#value"><span class="id" type="inductive">value</span></a> <a class="idref" href="Sub.html#s"><span class="id" type="variable">s</span></a> →<br/>
&nbsp;&nbsp;(<a class="idref" href="Sub.html#s"><span class="id" type="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'='_x"><span class="id" type="notation">=</span></a> <a class="idref" href="Sub.html#ttrue"><span class="id" type="constructor">ttrue</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'\/'_x"><span class="id" type="notation">∨</span></a> <a class="idref" href="Sub.html#s"><span class="id" type="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'='_x"><span class="id" type="notation">=</span></a> <a class="idref" href="Sub.html#tfalse"><span class="id" type="constructor">tfalse</span></a>).<br/>
<span class="id" type="keyword">Proof</span> <span class="id" type="keyword">with</span> <span class="id" type="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">Gamma</span> <span class="id" type="var">s</span> <span class="id" type="var">Hty</span> <span class="id" type="var">Hv</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">remember</span> <a class="idref" href="Sub.html#TBool"><span class="id" type="constructor">TBool</span></a> <span class="id" type="keyword">as</span> <span class="id" type="var">T</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">has_type_cases</span> (<span class="id" type="tactic">induction</span> <span class="id" type="var">Hty</span>) <span class="id" type="var">Case</span>; <span class="id" type="tactic">try</span> <span class="id" type="tactic">solve</span> <span class="id" type="tactic">by</span> <span class="id" type="tactic">inversion</span>...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_Sub".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">subst</span>. <span class="id" type="tactic">apply</span> <a class="idref" href="Sub.html#sub_inversion_Bool"><span class="id" type="axiom">sub_inversion_Bool</span></a> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>. <span class="id" type="tactic">subst</span>...<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab813"></a><h2 class="section">Progress</h2>

<div class="paragraph"> </div>

 The proof of progress proceeds like the one for the pure
    STLC, except that in several places we invoke canonical forms
    lemmas... 
<div class="paragraph"> </div>

 <i>Theorem</i> (Progress): For any term <span class="inlinecode"><a class="idref" href="ImpParser.html#t"><span class="id" type="variable">t</span></a></span> and type <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span>, if <span class="inlinecode"><a class="idref" href="RecordSub.html#empty"><span class="id" type="definition">empty</span></a></span> <span class="inlinecode">|-</span>
    <span class="inlinecode"><a class="idref" href="ImpParser.html#t"><span class="id" type="variable">t</span></a></span> <span class="inlinecode">:</span> <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> then <span class="inlinecode"><a class="idref" href="ImpParser.html#t"><span class="id" type="variable">t</span></a></span> is a value or <span class="inlinecode"><a class="idref" href="ImpParser.html#t"><span class="id" type="variable">t</span></a></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><a class="idref" href="Smallstep.html#t'"><span class="id" type="variable">t'</span></a></span> for some term <span class="inlinecode"><a class="idref" href="Smallstep.html#t'"><span class="id" type="variable">t'</span></a></span>.

<div class="paragraph"> </div>

    <i>Proof</i>: Let <span class="inlinecode"><a class="idref" href="ImpParser.html#t"><span class="id" type="variable">t</span></a></span> and <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> be given, with <span class="inlinecode"><a class="idref" href="RecordSub.html#empty"><span class="id" type="definition">empty</span></a></span> <span class="inlinecode">|-</span> <span class="inlinecode"><a class="idref" href="ImpParser.html#t"><span class="id" type="variable">t</span></a></span> <span class="inlinecode">:</span> <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span>.  Proceed
    by induction on the typing derivation.  

<div class="paragraph"> </div>

    The cases for <span class="inlinecode"><a class="idref" href="Norm.html#T_Abs"><span class="id" type="constructor">T_Abs</span></a></span>, <span class="inlinecode"><a class="idref" href="References.html#STLCRef.T_Unit"><span class="id" type="constructor">T_Unit</span></a></span>, <span class="inlinecode"><a class="idref" href="Norm.html#T_True"><span class="id" type="constructor">T_True</span></a></span> and <span class="inlinecode"><a class="idref" href="Norm.html#T_False"><span class="id" type="constructor">T_False</span></a></span> are
    immediate because abstractions, <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#unit"><span class="id" type="inductive">unit</span></a></span>, <span class="inlinecode"><a class="idref" href="Basics.html#true"><span class="id" type="constructor">true</span></a></span>, and <span class="inlinecode"><a class="idref" href="Basics.html#false"><span class="id" type="constructor">false</span></a></span> are
    already values.  The <span class="inlinecode"><a class="idref" href="Norm.html#T_Var"><span class="id" type="constructor">T_Var</span></a></span> case is vacuous because variables
    cannot be typed in the empty context.  The remaining cases are
    more interesting:

<div class="paragraph"> </div>

<ul class="doclist">
<li> If the last step in the typing derivation uses rule <span class="inlinecode"><a class="idref" href="Norm.html#T_App"><span class="id" type="constructor">T_App</span></a></span>,
      then there are terms <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span> and types <span class="inlinecode"><a class="idref" href="StlcProp.html#T1"><span class="id" type="variable">T1</span></a></span> and <span class="inlinecode"><a class="idref" href="StlcProp.html#T2"><span class="id" type="variable">T2</span></a></span> such that
      <span class="inlinecode"><a class="idref" href="ImpParser.html#t"><span class="id" type="variable">t</span></a></span> <span class="inlinecode">=</span> <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span>, <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> <span class="inlinecode">=</span> <span class="inlinecode"><a class="idref" href="StlcProp.html#T2"><span class="id" type="variable">T2</span></a></span>, <span class="inlinecode"><a class="idref" href="RecordSub.html#empty"><span class="id" type="definition">empty</span></a></span> <span class="inlinecode">|-</span> <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> <span class="inlinecode">:</span> <span class="inlinecode"><a class="idref" href="StlcProp.html#T1"><span class="id" type="variable">T1</span></a></span> <span class="inlinecode">→</span> <span class="inlinecode"><a class="idref" href="StlcProp.html#T2"><span class="id" type="variable">T2</span></a></span>, and <span class="inlinecode"><a class="idref" href="RecordSub.html#empty"><span class="id" type="definition">empty</span></a></span> <span class="inlinecode">|-</span>
      <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span> <span class="inlinecode">:</span> <span class="inlinecode"><a class="idref" href="StlcProp.html#T1"><span class="id" type="variable">T1</span></a></span>.  Moreover, by the induction hypothesis, either <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> is
      a value or it steps, and either <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span> is a value or it steps.
      There are three possibilities to consider:

<div class="paragraph"> </div>

<ul class="doclist">
<li> Suppose <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><a class="idref" href="Smallstep.html#t1'"><span class="id" type="variable">t1'</span></a></span> for some term <span class="inlinecode"><a class="idref" href="Smallstep.html#t1'"><span class="id" type="variable">t1'</span></a></span>.  Then <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><a class="idref" href="Smallstep.html#t1'"><span class="id" type="variable">t1'</span></a></span> <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span> 
        by <span class="inlinecode"><a class="idref" href="Norm.html#ST_App1"><span class="id" type="constructor">ST_App1</span></a></span>.

<div class="paragraph"> </div>


</li>
<li> Suppose <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> is a value and <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><a class="idref" href="Smallstep.html#t2'"><span class="id" type="variable">t2'</span></a></span> for some term <span class="inlinecode"><a class="idref" href="Smallstep.html#t2'"><span class="id" type="variable">t2'</span></a></span>.
        Then <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> <span class="inlinecode"><a class="idref" href="Smallstep.html#t2'"><span class="id" type="variable">t2'</span></a></span> by rule <span class="inlinecode"><a class="idref" href="Norm.html#ST_App2"><span class="id" type="constructor">ST_App2</span></a></span> because <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> is a
        value.

<div class="paragraph"> </div>


</li>
<li> Finally, suppose <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> and <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span> are both values.  By Lemma
        <span class="inlinecode"><span class="id" type="var">canonical_forms_for_arrow_types</span></span>, we know that <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> has the
        form <span class="inlinecode">\<a class="idref" href="RecordSub.html#Examples.x"><span class="id" type="abbreviation">x</span></a>:<span class="id" type="var">S1.s2</span></span> for some <span class="inlinecode"><a class="idref" href="RecordSub.html#Examples.x"><span class="id" type="abbreviation">x</span></a></span>, <span class="inlinecode"><a class="idref" href="Sub.html#S1"><span class="id" type="variable">S1</span></a></span>, and <span class="inlinecode"><a class="idref" href="Imp.html#s2"><span class="id" type="variable">s2</span></a></span>.  But then
        <span class="inlinecode">(\<a class="idref" href="RecordSub.html#Examples.x"><span class="id" type="abbreviation">x</span></a>:<span class="id" type="var">S1.s2</span>)</span> <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode">[<a class="idref" href="RecordSub.html#Examples.x"><span class="id" type="abbreviation">x</span></a>:=<a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a>]<a class="idref" href="Imp.html#s2"><span class="id" type="variable">s2</span></a></span> by <span class="inlinecode"><a class="idref" href="Norm.html#ST_AppAbs"><span class="id" type="constructor">ST_AppAbs</span></a></span>, since <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span> is a
        value.

<div class="paragraph"> </div>


</li>
</ul>

</li>
<li> If the final step of the derivation uses rule <span class="inlinecode"><a class="idref" href="Norm.html#T_If"><span class="id" type="constructor">T_If</span></a></span>, then there
      are terms <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span>, <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span>, and <span class="inlinecode"><a class="idref" href="Smallstep.html#t3"><span class="id" type="variable">t3</span></a></span> such that <span class="inlinecode"><a class="idref" href="ImpParser.html#t"><span class="id" type="variable">t</span></a></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="keyword">if</span></span> <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> <span class="inlinecode"><span class="id" type="keyword">then</span></span> <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span> <span class="inlinecode"><span class="id" type="keyword">else</span></span>
      <span class="inlinecode"><a class="idref" href="Smallstep.html#t3"><span class="id" type="variable">t3</span></a></span>, with <span class="inlinecode"><a class="idref" href="RecordSub.html#empty"><span class="id" type="definition">empty</span></a></span> <span class="inlinecode">|-</span> <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="library">Bool</span></span> and with <span class="inlinecode"><a class="idref" href="RecordSub.html#empty"><span class="id" type="definition">empty</span></a></span> <span class="inlinecode">|-</span> <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span> <span class="inlinecode">:</span> <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> and
      <span class="inlinecode"><a class="idref" href="RecordSub.html#empty"><span class="id" type="definition">empty</span></a></span> <span class="inlinecode">|-</span> <span class="inlinecode"><a class="idref" href="Smallstep.html#t3"><span class="id" type="variable">t3</span></a></span> <span class="inlinecode">:</span> <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span>.  Moreover, by the induction hypothesis,
      either <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> is a value or it steps.  

<div class="paragraph"> </div>

<ul class="doclist">
<li> If <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> is a value, then by the canonical forms lemma for
         booleans, either <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> <span class="inlinecode">=</span> <span class="inlinecode"><a class="idref" href="Basics.html#true"><span class="id" type="constructor">true</span></a></span> or <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> <span class="inlinecode">=</span> <span class="inlinecode"><a class="idref" href="Basics.html#false"><span class="id" type="constructor">false</span></a></span>.  In either
         case, <span class="inlinecode"><a class="idref" href="ImpParser.html#t"><span class="id" type="variable">t</span></a></span> can step, using rule <span class="inlinecode"><a class="idref" href="Norm.html#ST_IfTrue"><span class="id" type="constructor">ST_IfTrue</span></a></span> or <span class="inlinecode"><a class="idref" href="Norm.html#ST_IfFalse"><span class="id" type="constructor">ST_IfFalse</span></a></span>.

<div class="paragraph"> </div>


</li>
<li> If <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> can step, then so can <span class="inlinecode"><a class="idref" href="ImpParser.html#t"><span class="id" type="variable">t</span></a></span>, by rule <span class="inlinecode"><a class="idref" href="Norm.html#ST_If"><span class="id" type="constructor">ST_If</span></a></span>.

<div class="paragraph"> </div>


</li>
</ul>

</li>
<li> If the final step of the derivation is by <span class="inlinecode"><a class="idref" href="RecordSub.html#T_Sub"><span class="id" type="constructor">T_Sub</span></a></span>, then there is
      a type <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a></span> such that <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a></span> <span class="inlinecode">&lt;:</span> <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> and <span class="inlinecode"><a class="idref" href="RecordSub.html#empty"><span class="id" type="definition">empty</span></a></span> <span class="inlinecode">|-</span> <span class="inlinecode"><a class="idref" href="ImpParser.html#t"><span class="id" type="variable">t</span></a></span> <span class="inlinecode">:</span> <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a></span>.  The desired
      result is exactly the induction hypothesis for the typing
      subderivation.

</li>
</ul>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Theorem</span> <a name="progress"><span class="id" type="lemma">progress</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">t</span> <span class="id" type="var">T</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#empty"><span class="id" type="definition">empty</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#t"><span class="id" type="variable">t</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#value"><span class="id" type="inductive">value</span></a> <a class="idref" href="Sub.html#t"><span class="id" type="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'\/'_x"><span class="id" type="notation">∨</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:'exists'_x_'..'_x_','_x"><span class="id" type="notation">∃</span></a> <span class="id" type="var">t'</span><a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:'exists'_x_'..'_x_','_x"><span class="id" type="notation">,</span></a> <a class="idref" href="Sub.html#t"><span class="id" type="variable">t</span></a> <a class="idref" href="Sub.html#::x_'==>'_x"><span class="id" type="notation">==&gt;</span></a> <a class="idref" href="Sub.html#t'"><span class="id" type="variable">t'</span></a>.<br/>
<span class="id" type="keyword">Proof</span> <span class="id" type="keyword">with</span> <span class="id" type="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">T</span> <span class="id" type="var">Ht</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">remember</span> <a class="idref" href="Sub.html#empty"><span class="id" type="definition">empty</span></a> <span class="id" type="keyword">as</span> <span class="id" type="var">Gamma</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">revert</span> <span class="id" type="var">HeqGamma</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">has_type_cases</span> (<span class="id" type="tactic">induction</span> <span class="id" type="var">Ht</span>) <span class="id" type="var">Case</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">HeqGamma</span>; <span class="id" type="tactic">subst</span>...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_Var".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_App".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHHt1</span>; <span class="id" type="tactic">subst</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "t1 is a value".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHHt2</span>; <span class="id" type="tactic">subst</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SSCase</span> "t2 is a value".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<a class="idref" href="Sub.html#canonical_forms_of_arrow_types"><span class="id" type="axiom">canonical_forms_of_arrow_types</span></a> <a class="idref" href="Sub.html#empty"><span class="id" type="definition">empty</span></a> <span class="id" type="var">t1</span> <span class="id" type="var">T1</span> <span class="id" type="var">T2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [<span class="id" type="var">x</span> [<span class="id" type="var">S1</span> [<span class="id" type="var">t12</span> <span class="id" type="var">Heqt1</span>]]]...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">subst</span>. <span class="id" type="tactic">∃</span> (<a class="idref" href="Sub.html#::'['_x_':='_x_']'_x"><span class="id" type="notation">[</span></a><span class="id" type="var">x</span><a class="idref" href="Sub.html#::'['_x_':='_x_']'_x"><span class="id" type="notation">:=</span></a><span class="id" type="var">t2</span><a class="idref" href="Sub.html#::'['_x_':='_x_']'_x"><span class="id" type="notation">]</span></a><span class="id" type="var">t12</span>)...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SSCase</span> "t2 steps".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H0</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t2'</span> <span class="id" type="var">Hstp</span>]. <span class="id" type="tactic">∃</span> (<a class="idref" href="Sub.html#tapp"><span class="id" type="constructor">tapp</span></a> <span class="id" type="var">t1</span> <span class="id" type="var">t2'</span>)...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "t1 steps".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1'</span> <span class="id" type="var">Hstp</span>]. <span class="id" type="tactic">∃</span> (<a class="idref" href="Sub.html#tapp"><span class="id" type="constructor">tapp</span></a> <span class="id" type="var">t1'</span> <span class="id" type="var">t2</span>)...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_If".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHHt1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "t1 is a value"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">assert</span> (<span class="id" type="var">t1</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'='_x"><span class="id" type="notation">=</span></a> <a class="idref" href="Sub.html#ttrue"><span class="id" type="constructor">ttrue</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'\/'_x"><span class="id" type="notation">∨</span></a> <span class="id" type="var">t1</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'='_x"><span class="id" type="notation">=</span></a> <a class="idref" href="Sub.html#tfalse"><span class="id" type="constructor">tfalse</span></a>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">by</span> (<span class="id" type="tactic">eapply</span> <a class="idref" href="Sub.html#canonical_forms_of_Bool"><span class="id" type="lemma">canonical_forms_of_Bool</span></a>; <span class="id" type="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">subst</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>. <span class="id" type="tactic">rename</span> <span class="id" type="var">x</span> <span class="id" type="var">into</span> <span class="id" type="var">t1'</span>. <span class="id" type="tactic">eauto</span>.<br/>

<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab814"></a><h2 class="section">Inversion Lemmas for Typing</h2>

<div class="paragraph"> </div>

 The proof of the preservation theorem also becomes a little more
    complex with the addition of subtyping.  The reason is that, as
    with the "inversion lemmas for subtyping" above, there are a
    number of facts about the typing relation that are "obvious from
    the definition" in the pure STLC (and hence can be obtained
    directly from the <span class="inlinecode"><span class="id" type="tactic">inversion</span></span> tactic) but that require real proofs
    in the presence of subtyping because there are multiple ways to
    derive the same <span class="inlinecode"><a class="idref" href="Norm.html#has_type"><span class="id" type="inductive">has_type</span></a></span> statement.

<div class="paragraph"> </div>

    The following "inversion lemma" tells us that, if we have a
    derivation of some typing statement <span class="inlinecode"><a class="idref" href="SfLib.html#Gamma"><span class="id" type="variable">Gamma</span></a></span> <span class="inlinecode">|-</span> <span class="inlinecode">\<a class="idref" href="RecordSub.html#Examples.x"><span class="id" type="abbreviation">x</span></a>:<span class="id" type="var">S1.t2</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> whose
    subject is an abstraction, then there must be some subderivation
    giving a type to the body <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span>. 
<div class="paragraph"> </div>

 <i>Lemma</i>: If <span class="inlinecode"><a class="idref" href="SfLib.html#Gamma"><span class="id" type="variable">Gamma</span></a></span> <span class="inlinecode">|-</span> <span class="inlinecode">\<a class="idref" href="RecordSub.html#Examples.x"><span class="id" type="abbreviation">x</span></a>:<span class="id" type="var">S1.t2</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span>, then there is a type <span class="inlinecode"><a class="idref" href="Sub.html#S2"><span class="id" type="variable">S2</span></a></span>
    such that <span class="inlinecode"><a class="idref" href="SfLib.html#Gamma"><span class="id" type="variable">Gamma</span></a>,</span> <span class="inlinecode"><a class="idref" href="RecordSub.html#Examples.x"><span class="id" type="abbreviation">x</span></a>:<a class="idref" href="Sub.html#S1"><span class="id" type="variable">S1</span></a></span> <span class="inlinecode">|-</span> <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span> <span class="inlinecode">:</span> <span class="inlinecode"><a class="idref" href="Sub.html#S2"><span class="id" type="variable">S2</span></a></span> and <span class="inlinecode"><a class="idref" href="Sub.html#S1"><span class="id" type="variable">S1</span></a></span> <span class="inlinecode">→</span> <span class="inlinecode"><a class="idref" href="Sub.html#S2"><span class="id" type="variable">S2</span></a></span> <span class="inlinecode">&lt;:</span> <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span>.

<div class="paragraph"> </div>

    (Notice that the lemma does <i>not</i> say, "then <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> itself is an arrow
    type" -- this is tempting, but false!)

<div class="paragraph"> </div>

    <i>Proof</i>: Let <span class="inlinecode"><a class="idref" href="SfLib.html#Gamma"><span class="id" type="variable">Gamma</span></a></span>, <span class="inlinecode"><a class="idref" href="RecordSub.html#Examples.x"><span class="id" type="abbreviation">x</span></a></span>, <span class="inlinecode"><a class="idref" href="Sub.html#S1"><span class="id" type="variable">S1</span></a></span>, <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span> and <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> be given as
     described.  Proceed by induction on the derivation of <span class="inlinecode"><a class="idref" href="SfLib.html#Gamma"><span class="id" type="variable">Gamma</span></a></span> <span class="inlinecode">|-</span>
     <span class="inlinecode">\<a class="idref" href="RecordSub.html#Examples.x"><span class="id" type="abbreviation">x</span></a>:<span class="id" type="var">S1.t2</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span>.  Cases <span class="inlinecode"><a class="idref" href="Norm.html#T_Var"><span class="id" type="constructor">T_Var</span></a></span>, <span class="inlinecode"><a class="idref" href="Norm.html#T_App"><span class="id" type="constructor">T_App</span></a></span>, are vacuous as those
     rules cannot be used to give a type to a syntactic abstraction.

<div class="paragraph"> </div>

<ul class="doclist">
<li> If the last step of the derivation is a use of <span class="inlinecode"><a class="idref" href="Norm.html#T_Abs"><span class="id" type="constructor">T_Abs</span></a></span> then
       there is a type <span class="inlinecode"><a class="idref" href="Stlc.html#T12"><span class="id" type="variable">T12</span></a></span> such that <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> <span class="inlinecode">=</span> <span class="inlinecode"><a class="idref" href="Sub.html#S1"><span class="id" type="variable">S1</span></a></span> <span class="inlinecode">→</span> <span class="inlinecode"><a class="idref" href="Stlc.html#T12"><span class="id" type="variable">T12</span></a></span> and <span class="inlinecode"><a class="idref" href="SfLib.html#Gamma"><span class="id" type="variable">Gamma</span></a>,</span>
       <span class="inlinecode"><a class="idref" href="RecordSub.html#Examples.x"><span class="id" type="abbreviation">x</span></a>:<a class="idref" href="Sub.html#S1"><span class="id" type="variable">S1</span></a></span> <span class="inlinecode">|-</span> <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span> <span class="inlinecode">:</span> <span class="inlinecode"><a class="idref" href="Stlc.html#T12"><span class="id" type="variable">T12</span></a></span>.  Picking <span class="inlinecode"><a class="idref" href="Stlc.html#T12"><span class="id" type="variable">T12</span></a></span> for <span class="inlinecode"><a class="idref" href="Sub.html#S2"><span class="id" type="variable">S2</span></a></span> gives us what we
       need: <span class="inlinecode"><a class="idref" href="Sub.html#S1"><span class="id" type="variable">S1</span></a></span> <span class="inlinecode">→</span> <span class="inlinecode"><a class="idref" href="Stlc.html#T12"><span class="id" type="variable">T12</span></a></span> <span class="inlinecode">&lt;:</span> <span class="inlinecode"><a class="idref" href="Sub.html#S1"><span class="id" type="variable">S1</span></a></span> <span class="inlinecode">→</span> <span class="inlinecode"><a class="idref" href="Stlc.html#T12"><span class="id" type="variable">T12</span></a></span> follows from <span class="inlinecode"><a class="idref" href="RecordSub.html#S_Refl"><span class="id" type="constructor">S_Refl</span></a></span>.

<div class="paragraph"> </div>


</li>
<li> If the last step of the derivation is a use of <span class="inlinecode"><a class="idref" href="RecordSub.html#T_Sub"><span class="id" type="constructor">T_Sub</span></a></span> then
       there is a type <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a></span> such that <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a></span> <span class="inlinecode">&lt;:</span> <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> and <span class="inlinecode"><a class="idref" href="SfLib.html#Gamma"><span class="id" type="variable">Gamma</span></a></span> <span class="inlinecode">|-</span> <span class="inlinecode">\<a class="idref" href="RecordSub.html#Examples.x"><span class="id" type="abbreviation">x</span></a>:<span class="id" type="var">S1.t2</span></span> <span class="inlinecode">:</span>
       <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a></span>.  The IH for the typing subderivation tell us that there is
       some type <span class="inlinecode"><a class="idref" href="Sub.html#S2"><span class="id" type="variable">S2</span></a></span> with <span class="inlinecode"><a class="idref" href="Sub.html#S1"><span class="id" type="variable">S1</span></a></span> <span class="inlinecode">→</span> <span class="inlinecode"><a class="idref" href="Sub.html#S2"><span class="id" type="variable">S2</span></a></span> <span class="inlinecode">&lt;:</span> <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a></span> and <span class="inlinecode"><a class="idref" href="SfLib.html#Gamma"><span class="id" type="variable">Gamma</span></a>,</span> <span class="inlinecode"><a class="idref" href="RecordSub.html#Examples.x"><span class="id" type="abbreviation">x</span></a>:<a class="idref" href="Sub.html#S1"><span class="id" type="variable">S1</span></a></span> <span class="inlinecode">|-</span> <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span> <span class="inlinecode">:</span>
       <span class="inlinecode"><a class="idref" href="Sub.html#S2"><span class="id" type="variable">S2</span></a></span>.  Picking type <span class="inlinecode"><a class="idref" href="Sub.html#S2"><span class="id" type="variable">S2</span></a></span> gives us what we need, since <span class="inlinecode"><a class="idref" href="Sub.html#S1"><span class="id" type="variable">S1</span></a></span> <span class="inlinecode">→</span> <span class="inlinecode"><a class="idref" href="Sub.html#S2"><span class="id" type="variable">S2</span></a></span>
       <span class="inlinecode">&lt;:</span> <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> then follows by <span class="inlinecode"><a class="idref" href="RecordSub.html#S_Trans"><span class="id" type="constructor">S_Trans</span></a></span>. 
</li>
</ul>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <a name="typing_inversion_abs"><span class="id" type="lemma">typing_inversion_abs</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">Gamma</span> <span class="id" type="var">x</span> <span class="id" type="var">S1</span> <span class="id" type="var">t2</span> <span class="id" type="var">T</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#tabs"><span class="id" type="constructor">tabs</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="Sub.html#S1"><span class="id" type="variable">S1</span></a> <a class="idref" href="Sub.html#t2"><span class="id" type="variable">t2</span></a><a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:'exists'_x_'..'_x_','_x"><span class="id" type="notation">∃</span></a> <span class="id" type="var">S2</span><a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:'exists'_x_'..'_x_','_x"><span class="id" type="notation">,</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#TArrow"><span class="id" type="constructor">TArrow</span></a> <a class="idref" href="Sub.html#S1"><span class="id" type="variable">S1</span></a> <a class="idref" href="Sub.html#S2"><span class="id" type="variable">S2</span></a><a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">&lt;:</span></a> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'/\'_x"><span class="id" type="notation">∧</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#extend"><span class="id" type="definition">extend</span></a> <a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="Sub.html#S1"><span class="id" type="variable">S1</span></a><a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#t2"><span class="id" type="variable">t2</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#S2"><span class="id" type="variable">S2</span></a>).<br/>
<span class="id" type="keyword">Proof</span> <span class="id" type="keyword">with</span> <span class="id" type="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">Gamma</span> <span class="id" type="var">x</span> <span class="id" type="var">S1</span> <span class="id" type="var">t2</span> <span class="id" type="var">T</span> <span class="id" type="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">remember</span> (<a class="idref" href="Sub.html#tabs"><span class="id" type="constructor">tabs</span></a> <span class="id" type="var">x</span> <span class="id" type="var">S1</span> <span class="id" type="var">t2</span>) <span class="id" type="keyword">as</span> <span class="id" type="var">t</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">has_type_cases</span> (<span class="id" type="tactic">induction</span> <span class="id" type="var">H</span>) <span class="id" type="var">Case</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">Heqt</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">try</span> <span class="id" type="tactic">solve</span> <span class="id" type="tactic">by</span> <span class="id" type="tactic">inversion</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_Abs".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">∃</span> <span class="id" type="var">T12</span>...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_Sub".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHhas_type</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">S2</span> [<span class="id" type="var">Hsub</span> <span class="id" type="var">Hty</span>]]...<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Similarly... 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <a name="typing_inversion_var"><span class="id" type="lemma">typing_inversion_var</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">Gamma</span> <span class="id" type="var">x</span> <span class="id" type="var">T</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#tvar"><span class="id" type="constructor">tvar</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a><a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a> →<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:'exists'_x_'..'_x_','_x"><span class="id" type="notation">∃</span></a> <span class="id" type="var">S</span><a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:'exists'_x_'..'_x_','_x"><span class="id" type="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'='_x"><span class="id" type="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#Some"><span class="id" type="constructor">Some</span></a> <a class="idref" href="Sub.html#S"><span class="id" type="variable">S</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'/\'_x"><span class="id" type="notation">∧</span></a> <a class="idref" href="Sub.html#S"><span class="id" type="variable">S</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">&lt;:</span></a> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a>.<br/>
<span class="id" type="keyword">Proof</span> <span class="id" type="keyword">with</span> <span class="id" type="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">Gamma</span> <span class="id" type="var">x</span> <span class="id" type="var">T</span> <span class="id" type="var">Hty</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">remember</span> (<a class="idref" href="Sub.html#tvar"><span class="id" type="constructor">tvar</span></a> <span class="id" type="var">x</span>) <span class="id" type="keyword">as</span> <span class="id" type="var">t</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">has_type_cases</span> (<span class="id" type="tactic">induction</span> <span class="id" type="var">Hty</span>) <span class="id" type="var">Case</span>; <span class="id" type="tactic">intros</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">Heqt</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">try</span> <span class="id" type="tactic">solve</span> <span class="id" type="tactic">by</span> <span class="id" type="tactic">inversion</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_Var".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">∃</span> <span class="id" type="var">T</span>...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_Sub".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHHty</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">U</span> [<span class="id" type="var">Hctx</span> <span class="id" type="var">HsubU</span>]]... <span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <a name="typing_inversion_app"><span class="id" type="lemma">typing_inversion_app</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">Gamma</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">T2</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#tapp"><span class="id" type="constructor">tapp</span></a> <a class="idref" href="Sub.html#t1"><span class="id" type="variable">t1</span></a> <a class="idref" href="Sub.html#t2"><span class="id" type="variable">t2</span></a><a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#T2"><span class="id" type="variable">T2</span></a> →<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:'exists'_x_'..'_x_','_x"><span class="id" type="notation">∃</span></a> <span class="id" type="var">T1</span><a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:'exists'_x_'..'_x_','_x"><span class="id" type="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#t1"><span class="id" type="variable">t1</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#TArrow"><span class="id" type="constructor">TArrow</span></a> <a class="idref" href="Sub.html#T1"><span class="id" type="variable">T1</span></a> <a class="idref" href="Sub.html#T2"><span class="id" type="variable">T2</span></a><a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'/\'_x"><span class="id" type="notation">∧</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#t2"><span class="id" type="variable">t2</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#T1"><span class="id" type="variable">T1</span></a>.<br/>
<span class="id" type="keyword">Proof</span> <span class="id" type="keyword">with</span> <span class="id" type="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">Gamma</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">T2</span> <span class="id" type="var">Hty</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">remember</span> (<a class="idref" href="Sub.html#tapp"><span class="id" type="constructor">tapp</span></a> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) <span class="id" type="keyword">as</span> <span class="id" type="var">t</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">has_type_cases</span> (<span class="id" type="tactic">induction</span> <span class="id" type="var">Hty</span>) <span class="id" type="var">Case</span>; <span class="id" type="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">Heqt</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">try</span> <span class="id" type="tactic">solve</span> <span class="id" type="tactic">by</span> <span class="id" type="tactic">inversion</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_App".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">∃</span> <span class="id" type="var">T1</span>...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_Sub".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHHty</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">U1</span> [<span class="id" type="var">Hty1</span> <span class="id" type="var">Hty2</span>]]...<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <a name="typing_inversion_true"><span class="id" type="lemma">typing_inversion_true</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">Gamma</span> <span class="id" type="var">T</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#ttrue"><span class="id" type="constructor">ttrue</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a> →<br/>
&nbsp;&nbsp;<a class="idref" href="Sub.html#TBool"><span class="id" type="constructor">TBool</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">&lt;:</span></a> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a>.<br/>
<span class="id" type="keyword">Proof</span> <span class="id" type="keyword">with</span> <span class="id" type="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">Gamma</span> <span class="id" type="var">T</span> <span class="id" type="var">Htyp</span>. <span class="id" type="var">remember</span> <a class="idref" href="Sub.html#ttrue"><span class="id" type="constructor">ttrue</span></a> <span class="id" type="keyword">as</span> <span class="id" type="var">tu</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">has_type_cases</span> (<span class="id" type="tactic">induction</span> <span class="id" type="var">Htyp</span>) <span class="id" type="var">Case</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">Heqtu</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">intros</span>...<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <a name="typing_inversion_false"><span class="id" type="lemma">typing_inversion_false</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">Gamma</span> <span class="id" type="var">T</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#tfalse"><span class="id" type="constructor">tfalse</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a> →<br/>
&nbsp;&nbsp;<a class="idref" href="Sub.html#TBool"><span class="id" type="constructor">TBool</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">&lt;:</span></a> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a>.<br/>
<span class="id" type="keyword">Proof</span> <span class="id" type="keyword">with</span> <span class="id" type="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">Gamma</span> <span class="id" type="var">T</span> <span class="id" type="var">Htyp</span>. <span class="id" type="var">remember</span> <a class="idref" href="Sub.html#tfalse"><span class="id" type="constructor">tfalse</span></a> <span class="id" type="keyword">as</span> <span class="id" type="var">tu</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">has_type_cases</span> (<span class="id" type="tactic">induction</span> <span class="id" type="var">Htyp</span>) <span class="id" type="var">Case</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">Heqtu</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">intros</span>...<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <a name="typing_inversion_if"><span class="id" type="lemma">typing_inversion_if</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">Gamma</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span> <span class="id" type="var">T</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#tif"><span class="id" type="constructor">tif</span></a> <a class="idref" href="Sub.html#t1"><span class="id" type="variable">t1</span></a> <a class="idref" href="Sub.html#t2"><span class="id" type="variable">t2</span></a> <a class="idref" href="Sub.html#t3"><span class="id" type="variable">t3</span></a><a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a> →<br/>
&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#t1"><span class="id" type="variable">t1</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#TBool"><span class="id" type="constructor">TBool</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'/\'_x"><span class="id" type="notation">∧</span></a> <a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#t2"><span class="id" type="variable">t2</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'/\'_x"><span class="id" type="notation">∧</span></a> <a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#t3"><span class="id" type="variable">t3</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a>.<br/>
<span class="id" type="keyword">Proof</span> <span class="id" type="keyword">with</span> <span class="id" type="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">Gamma</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span> <span class="id" type="var">T</span> <span class="id" type="var">Hty</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">remember</span> (<a class="idref" href="Sub.html#tif"><span class="id" type="constructor">tif</span></a> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span>) <span class="id" type="keyword">as</span> <span class="id" type="var">t</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">has_type_cases</span> (<span class="id" type="tactic">induction</span> <span class="id" type="var">Hty</span>) <span class="id" type="var">Case</span>; <span class="id" type="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">Heqt</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">try</span> <span class="id" type="tactic">solve</span> <span class="id" type="tactic">by</span> <span class="id" type="tactic">inversion</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_If".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_Sub".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHHty</span> <span class="id" type="var">H0</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> [<span class="id" type="var">H2</span> <span class="id" type="var">H3</span>]]...<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <a name="typing_inversion_unit"><span class="id" type="lemma">typing_inversion_unit</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">Gamma</span> <span class="id" type="var">T</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#tunit"><span class="id" type="constructor">tunit</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#TUnit"><span class="id" type="constructor">TUnit</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">&lt;:</span></a> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a>.<br/>
<span class="id" type="keyword">Proof</span> <span class="id" type="keyword">with</span> <span class="id" type="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">Gamma</span> <span class="id" type="var">T</span> <span class="id" type="var">Htyp</span>. <span class="id" type="var">remember</span> <a class="idref" href="Sub.html#tunit"><span class="id" type="constructor">tunit</span></a> <span class="id" type="keyword">as</span> <span class="id" type="var">tu</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">has_type_cases</span> (<span class="id" type="tactic">induction</span> <span class="id" type="var">Htyp</span>) <span class="id" type="var">Case</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">Heqtu</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">intros</span>...<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The inversion lemmas for typing and for subtyping between arrow
    types can be packaged up as a useful "combination lemma" telling
    us exactly what we'll actually require below. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <a name="abs_arrow"><span class="id" type="lemma">abs_arrow</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">x</span> <span class="id" type="var">S1</span> <span class="id" type="var">s2</span> <span class="id" type="var">T1</span> <span class="id" type="var">T2</span>, <br/>
&nbsp;&nbsp;<a class="idref" href="Sub.html#empty"><span class="id" type="definition">empty</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#tabs"><span class="id" type="constructor">tabs</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="Sub.html#S1"><span class="id" type="variable">S1</span></a> <a class="idref" href="Sub.html#s2"><span class="id" type="variable">s2</span></a><a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#TArrow"><span class="id" type="constructor">TArrow</span></a> <a class="idref" href="Sub.html#T1"><span class="id" type="variable">T1</span></a> <a class="idref" href="Sub.html#T2"><span class="id" type="variable">T2</span></a><a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">)</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#T1"><span class="id" type="variable">T1</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">&lt;:</span></a> <a class="idref" href="Sub.html#S1"><span class="id" type="variable">S1</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'/\'_x"><span class="id" type="notation">∧</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#extend"><span class="id" type="definition">extend</span></a> <a class="idref" href="Sub.html#empty"><span class="id" type="definition">empty</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="Sub.html#S1"><span class="id" type="variable">S1</span></a><a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#s2"><span class="id" type="variable">s2</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#T2"><span class="id" type="variable">T2</span></a>.<br/>
<span class="id" type="keyword">Proof</span> <span class="id" type="keyword">with</span> <span class="id" type="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">S1</span> <span class="id" type="var">s2</span> <span class="id" type="var">T1</span> <span class="id" type="var">T2</span> <span class="id" type="var">Hty</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="Sub.html#typing_inversion_abs"><span class="id" type="lemma">typing_inversion_abs</span></a> <span class="id" type="keyword">in</span> <span class="id" type="var">Hty</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hty</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">S2</span> [<span class="id" type="var">Hsub</span> <span class="id" type="var">Hty1</span>]].<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="Sub.html#sub_inversion_arrow"><span class="id" type="axiom">sub_inversion_arrow</span></a> <span class="id" type="keyword">in</span> <span class="id" type="var">Hsub</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hsub</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">U1</span> [<span class="id" type="var">U2</span> [<span class="id" type="var">Heq</span> [<span class="id" type="var">Hsub1</span> <span class="id" type="var">Hsub2</span>]]]].<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">Heq</span>; <span class="id" type="tactic">subst</span>... <span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab815"></a><h2 class="section">Context Invariance</h2>

<div class="paragraph"> </div>

 The context invariance lemma follows the same pattern as in the
    pure STLC. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Inductive</span> <a name="appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> : <a class="idref" href="SfLib.html#id"><span class="id" type="inductive">id</span></a> → <a class="idref" href="Sub.html#tm"><span class="id" type="inductive">tm</span></a> → <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a name="afi_var"><span class="id" type="constructor">afi_var</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> (<a class="idref" href="Sub.html#tvar"><span class="id" type="constructor">tvar</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a>)<br/>
&nbsp;&nbsp;| <a name="afi_app1"><span class="id" type="constructor">afi_app1</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">x</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="Sub.html#t1"><span class="id" type="variable">t1</span></a> → <a class="idref" href="Sub.html#appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> (<a class="idref" href="Sub.html#tapp"><span class="id" type="constructor">tapp</span></a> <a class="idref" href="Sub.html#t1"><span class="id" type="variable">t1</span></a> <a class="idref" href="Sub.html#t2"><span class="id" type="variable">t2</span></a>)<br/>
&nbsp;&nbsp;| <a name="afi_app2"><span class="id" type="constructor">afi_app2</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">x</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="Sub.html#t2"><span class="id" type="variable">t2</span></a> → <a class="idref" href="Sub.html#appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> (<a class="idref" href="Sub.html#tapp"><span class="id" type="constructor">tapp</span></a> <a class="idref" href="Sub.html#t1"><span class="id" type="variable">t1</span></a> <a class="idref" href="Sub.html#t2"><span class="id" type="variable">t2</span></a>)<br/>
&nbsp;&nbsp;| <a name="afi_abs"><span class="id" type="constructor">afi_abs</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">T11</span> <span class="id" type="var">t12</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#y"><span class="id" type="variable">y</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'<>'_x"><span class="id" type="notation">≠</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a>  →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="Sub.html#t12"><span class="id" type="variable">t12</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> (<a class="idref" href="Sub.html#tabs"><span class="id" type="constructor">tabs</span></a> <a class="idref" href="Sub.html#y"><span class="id" type="variable">y</span></a> <a class="idref" href="Sub.html#T11"><span class="id" type="variable">T11</span></a> <a class="idref" href="Sub.html#t12"><span class="id" type="variable">t12</span></a>)<br/>
&nbsp;&nbsp;| <a name="afi_if1"><span class="id" type="constructor">afi_if1</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">x</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="Sub.html#t1"><span class="id" type="variable">t1</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> (<a class="idref" href="Sub.html#tif"><span class="id" type="constructor">tif</span></a> <a class="idref" href="Sub.html#t1"><span class="id" type="variable">t1</span></a> <a class="idref" href="Sub.html#t2"><span class="id" type="variable">t2</span></a> <a class="idref" href="Sub.html#t3"><span class="id" type="variable">t3</span></a>)<br/>
&nbsp;&nbsp;| <a name="afi_if2"><span class="id" type="constructor">afi_if2</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">x</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="Sub.html#t2"><span class="id" type="variable">t2</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> (<a class="idref" href="Sub.html#tif"><span class="id" type="constructor">tif</span></a> <a class="idref" href="Sub.html#t1"><span class="id" type="variable">t1</span></a> <a class="idref" href="Sub.html#t2"><span class="id" type="variable">t2</span></a> <a class="idref" href="Sub.html#t3"><span class="id" type="variable">t3</span></a>)<br/>
&nbsp;&nbsp;| <a name="afi_if3"><span class="id" type="constructor">afi_if3</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">x</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="Sub.html#t3"><span class="id" type="variable">t3</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> (<a class="idref" href="Sub.html#tif"><span class="id" type="constructor">tif</span></a> <a class="idref" href="Sub.html#t1"><span class="id" type="variable">t1</span></a> <a class="idref" href="Sub.html#t2"><span class="id" type="variable">t2</span></a> <a class="idref" href="Sub.html#t3"><span class="id" type="variable">t3</span></a>)<br/>
.<br/>

<br/>
<span class="id" type="keyword">Hint Constructors</span> <a class="idref" href="Sub.html#appears_free_in"><span class="id" type="inductive">appears_free_in</span></a>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <a name="context_invariance"><span class="id" type="lemma">context_invariance</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">Gamma</span> <span class="id" type="var">Gamma'</span> <span class="id" type="var">t</span> <span class="id" type="var">S</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#t"><span class="id" type="variable">t</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#S"><span class="id" type="variable">S</span></a>  →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">∀</span> <span class="id" type="var">x</span>, <a class="idref" href="Sub.html#appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="Sub.html#t"><span class="id" type="variable">t</span></a> → <a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'='_x"><span class="id" type="notation">=</span></a> <a class="idref" href="Sub.html#Gamma'"><span class="id" type="variable">Gamma'</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a>)  →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma'"><span class="id" type="variable">Gamma'</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#t"><span class="id" type="variable">t</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#S"><span class="id" type="variable">S</span></a>.<br/>
<span class="id" type="keyword">Proof</span> <span class="id" type="keyword">with</span> <span class="id" type="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span>. <span class="id" type="tactic">generalize</span> <span class="id" type="tactic">dependent</span> <span class="id" type="var">Gamma'</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">has_type_cases</span> (<span class="id" type="tactic">induction</span> <span class="id" type="var">H</span>) <span class="id" type="var">Case</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">Gamma'</span> <span class="id" type="var">Heqv</span>...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_Var".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="Sub.html#T_Var"><span class="id" type="constructor">T_Var</span></a>... <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Heqv</span>...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_Abs".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="Sub.html#T_Abs"><span class="id" type="constructor">T_Abs</span></a>... <span class="id" type="tactic">apply</span> <span class="id" type="var">IHhas_type</span>. <span class="id" type="tactic">intros</span> <span class="id" type="var">x0</span> <span class="id" type="var">Hafi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <a class="idref" href="Sub.html#extend"><span class="id" type="definition">extend</span></a>. <span class="id" type="tactic">destruct</span> (<a class="idref" href="SfLib.html#eq_id_dec"><span class="id" type="lemma">eq_id_dec</span></a> <span class="id" type="var">x</span> <span class="id" type="var">x0</span>)...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_If".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="Sub.html#T_If"><span class="id" type="constructor">T_If</span></a>...<br/>

<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <a name="free_in_context"><span class="id" type="lemma">free_in_context</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">x</span> <span class="id" type="var">t</span> <span class="id" type="var">T</span> <span class="id" type="var">Gamma</span>,<br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="Sub.html#t"><span class="id" type="variable">t</span></a> →<br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#t"><span class="id" type="variable">t</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a> →<br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:'exists'_x_'..'_x_','_x"><span class="id" type="notation">∃</span></a> <span class="id" type="var">T'</span><a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:'exists'_x_'..'_x_','_x"><span class="id" type="notation">,</span></a> <a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'='_x"><span class="id" type="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Datatypes.html#Some"><span class="id" type="constructor">Some</span></a> <a class="idref" href="Sub.html#T'"><span class="id" type="variable">T'</span></a>.<br/>
<span class="id" type="keyword">Proof</span> <span class="id" type="keyword">with</span> <span class="id" type="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">t</span> <span class="id" type="var">T</span> <span class="id" type="var">Gamma</span> <span class="id" type="var">Hafi</span> <span class="id" type="var">Htyp</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">has_type_cases</span> (<span class="id" type="tactic">induction</span> <span class="id" type="var">Htyp</span>) <span class="id" type="var">Case</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Hafi</span>; <span class="id" type="tactic">subst</span>...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_Abs".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHHtyp</span> <span class="id" type="var">H4</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">T</span> <span class="id" type="var">Hctx</span>]. <span class="id" type="tactic">∃</span> <span class="id" type="var">T</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <a class="idref" href="Sub.html#extend"><span class="id" type="definition">extend</span></a> <span class="id" type="keyword">in</span> <span class="id" type="var">Hctx</span>. <span class="id" type="tactic">rewrite</span> <a class="idref" href="SfLib.html#neq_id"><span class="id" type="axiom">neq_id</span></a> <span class="id" type="keyword">in</span> <span class="id" type="var">Hctx</span>... <span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab816"></a><h2 class="section">Substitution</h2>

<div class="paragraph"> </div>

 The <i>substitution lemma</i> is proved along the same lines as
    for the pure STLC.  The only significant change is that there are
    several places where, instead of the built-in <span class="inlinecode"><span class="id" type="tactic">inversion</span></span> tactic,
    we need to use the inversion lemmas that we proved above to
    extract structural information from assumptions about the
    well-typedness of subterms. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <a name="substitution_preserves_typing"><span class="id" type="lemma">substitution_preserves_typing</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">Gamma</span> <span class="id" type="var">x</span> <span class="id" type="var">U</span> <span class="id" type="var">v</span> <span class="id" type="var">t</span> <span class="id" type="var">S</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#extend"><span class="id" type="definition">extend</span></a> <a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a> <a class="idref" href="Sub.html#U"><span class="id" type="variable">U</span></a><a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#t"><span class="id" type="variable">t</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#S"><span class="id" type="variable">S</span></a>  →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#empty"><span class="id" type="definition">empty</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#v"><span class="id" type="variable">v</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#U"><span class="id" type="variable">U</span></a>   →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#Gamma"><span class="id" type="variable">Gamma</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#::'['_x_':='_x_']'_x"><span class="id" type="notation">[</span></a><a class="idref" href="Sub.html#x"><span class="id" type="variable">x</span></a><a class="idref" href="Sub.html#::'['_x_':='_x_']'_x"><span class="id" type="notation">:=</span></a><a class="idref" href="Sub.html#v"><span class="id" type="variable">v</span></a><a class="idref" href="Sub.html#::'['_x_':='_x_']'_x"><span class="id" type="notation">]</span></a><a class="idref" href="Sub.html#t"><span class="id" type="variable">t</span></a><a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#S"><span class="id" type="variable">S</span></a>.<br/>
<span class="id" type="keyword">Proof</span> <span class="id" type="keyword">with</span> <span class="id" type="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">Gamma</span> <span class="id" type="var">x</span> <span class="id" type="var">U</span> <span class="id" type="var">v</span> <span class="id" type="var">t</span> <span class="id" type="var">S</span> <span class="id" type="var">Htypt</span> <span class="id" type="var">Htypv</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">generalize</span> <span class="id" type="tactic">dependent</span> <span class="id" type="var">S</span>. <span class="id" type="tactic">generalize</span> <span class="id" type="tactic">dependent</span> <span class="id" type="var">Gamma</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">t_cases</span> (<span class="id" type="tactic">induction</span> <span class="id" type="var">t</span>) <span class="id" type="var">Case</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "tvar".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rename</span> <span class="id" type="var">i</span> <span class="id" type="var">into</span> <span class="id" type="var">y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<a class="idref" href="Sub.html#typing_inversion_var"><span class="id" type="lemma">typing_inversion_var</span></a> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Htypt</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [<span class="id" type="var">T</span> [<span class="id" type="var">Hctx</span> <span class="id" type="var">Hsub</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <a class="idref" href="Sub.html#extend"><span class="id" type="definition">extend</span></a> <span class="id" type="keyword">in</span> <span class="id" type="var">Hctx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<a class="idref" href="SfLib.html#eq_id_dec"><span class="id" type="lemma">eq_id_dec</span></a> <span class="id" type="var">x</span> <span class="id" type="var">y</span>)...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "x=y".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hctx</span>; <span class="id" type="tactic">subst</span>. <span class="id" type="tactic">clear</span> <span class="id" type="var">Hctx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="Sub.html#context_invariance"><span class="id" type="lemma">context_invariance</span></a> <span class="id" type="keyword">with</span> <a class="idref" href="Sub.html#empty"><span class="id" type="definition">empty</span></a>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">Hcontra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<a class="idref" href="Sub.html#free_in_context"><span class="id" type="lemma">free_in_context</span></a> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">S</span> <a class="idref" href="Sub.html#empty"><span class="id" type="definition">empty</span></a> <span class="id" type="var">Hcontra</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [<span class="id" type="var">T'</span> <span class="id" type="var">HT'</span>]...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">HT'</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "tapp".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<a class="idref" href="Sub.html#typing_inversion_app"><span class="id" type="lemma">typing_inversion_app</span></a> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Htypt</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [<span class="id" type="var">T1</span> [<span class="id" type="var">Htypt1</span> <span class="id" type="var">Htypt2</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <a class="idref" href="Sub.html#T_App"><span class="id" type="constructor">T_App</span></a>...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "tabs".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rename</span> <span class="id" type="var">i</span> <span class="id" type="var">into</span> <span class="id" type="var">y</span>. <span class="id" type="tactic">rename</span> <span class="id" type="var">t</span> <span class="id" type="var">into</span> <span class="id" type="var">T1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<a class="idref" href="Sub.html#typing_inversion_abs"><span class="id" type="lemma">typing_inversion_abs</span></a> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Htypt</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [<span class="id" type="var">T2</span> [<span class="id" type="var">Hsub</span> <span class="id" type="var">Htypt2</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="Sub.html#T_Sub"><span class="id" type="constructor">T_Sub</span></a> <span class="id" type="keyword">with</span> (<a class="idref" href="Sub.html#TArrow"><span class="id" type="constructor">TArrow</span></a> <span class="id" type="var">T1</span> <span class="id" type="var">T2</span>)... <span class="id" type="tactic">apply</span> <a class="idref" href="Sub.html#T_Abs"><span class="id" type="constructor">T_Abs</span></a>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<a class="idref" href="SfLib.html#eq_id_dec"><span class="id" type="lemma">eq_id_dec</span></a> <span class="id" type="var">x</span> <span class="id" type="var">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "x=y".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <a class="idref" href="Sub.html#context_invariance"><span class="id" type="lemma">context_invariance</span></a>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">Hafi</span>. <span class="id" type="tactic">unfold</span> <a class="idref" href="Sub.html#extend"><span class="id" type="definition">extend</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<a class="idref" href="SfLib.html#eq_id_dec"><span class="id" type="lemma">eq_id_dec</span></a> <span class="id" type="var">y</span> <span class="id" type="var">x</span>)...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "x&lt;&gt;y".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">IHt</span>. <span class="id" type="tactic">eapply</span> <a class="idref" href="Sub.html#context_invariance"><span class="id" type="lemma">context_invariance</span></a>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">z</span> <span class="id" type="var">Hafi</span>. <span class="id" type="tactic">unfold</span> <a class="idref" href="Sub.html#extend"><span class="id" type="definition">extend</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<a class="idref" href="SfLib.html#eq_id_dec"><span class="id" type="lemma">eq_id_dec</span></a> <span class="id" type="var">y</span> <span class="id" type="var">z</span>)...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">subst</span>. <span class="id" type="tactic">rewrite</span> <a class="idref" href="SfLib.html#neq_id"><span class="id" type="axiom">neq_id</span></a>...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "ttrue".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">assert</span> (<a class="idref" href="Sub.html#TBool"><span class="id" type="constructor">TBool</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">&lt;:</span></a> <span class="id" type="var">S</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">by</span> <span class="id" type="tactic">apply</span> (<a class="idref" href="Sub.html#typing_inversion_true"><span class="id" type="lemma">typing_inversion_true</span></a> <span class="id" type="var">_</span> <span class="id" type="var">_</span>  <span class="id" type="var">Htypt</span>)...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "tfalse".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">assert</span> (<a class="idref" href="Sub.html#TBool"><span class="id" type="constructor">TBool</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">&lt;:</span></a> <span class="id" type="var">S</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">by</span> <span class="id" type="tactic">apply</span> (<a class="idref" href="Sub.html#typing_inversion_false"><span class="id" type="lemma">typing_inversion_false</span></a> <span class="id" type="var">_</span> <span class="id" type="var">_</span>  <span class="id" type="var">Htypt</span>)...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "tif".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">assert</span> (<a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#extend"><span class="id" type="definition">extend</span></a> <span class="id" type="var">Gamma</span> <span class="id" type="var">x</span> <span class="id" type="var">U</span><a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <span class="id" type="var">t1</span> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#TBool"><span class="id" type="constructor">TBool</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'/\'_x"><span class="id" type="notation">∧</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#extend"><span class="id" type="definition">extend</span></a> <span class="id" type="var">Gamma</span> <span class="id" type="var">x</span> <span class="id" type="var">U</span><a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <span class="id" type="var">t2</span> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <span class="id" type="var">S</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.4pl5/stdlib/Coq.Init.Logic.html#:type_scope:x_'/\'_x"><span class="id" type="notation">∧</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">(</span></a><a class="idref" href="Sub.html#extend"><span class="id" type="definition">extend</span></a> <span class="id" type="var">Gamma</span> <span class="id" type="var">x</span> <span class="id" type="var">U</span><a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">)</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <span class="id" type="var">t3</span> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <span class="id" type="var">S</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">by</span> <span class="id" type="tactic">apply</span> (<a class="idref" href="Sub.html#typing_inversion_if"><span class="id" type="lemma">typing_inversion_if</span></a> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Htypt</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> [<span class="id" type="var">H2</span> <span class="id" type="var">H3</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">IHt1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">IHt2</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">IHt3</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "tunit".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">assert</span> (<a class="idref" href="Sub.html#TUnit"><span class="id" type="constructor">TUnit</span></a> <a class="idref" href="Sub.html#::x_'<:'_x"><span class="id" type="notation">&lt;:</span></a> <span class="id" type="var">S</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">by</span> <span class="id" type="tactic">apply</span> (<a class="idref" href="Sub.html#typing_inversion_unit"><span class="id" type="lemma">typing_inversion_unit</span></a> <span class="id" type="var">_</span> <span class="id" type="var">_</span>  <span class="id" type="var">Htypt</span>)...<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab817"></a><h2 class="section">Preservation</h2>

<div class="paragraph"> </div>

 The proof of preservation now proceeds pretty much as in earlier
    chapters, using the substitution lemma at the appropriate point
    and again using inversion lemmas from above to extract structural
    information from typing assumptions. 
<div class="paragraph"> </div>

 <i>Theorem</i> (Preservation): If <span class="inlinecode"><a class="idref" href="ImpParser.html#t"><span class="id" type="variable">t</span></a></span>, <span class="inlinecode"><a class="idref" href="Smallstep.html#t'"><span class="id" type="variable">t'</span></a></span> are terms and <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> is a type
    such that <span class="inlinecode"><a class="idref" href="RecordSub.html#empty"><span class="id" type="definition">empty</span></a></span> <span class="inlinecode">|-</span> <span class="inlinecode"><a class="idref" href="ImpParser.html#t"><span class="id" type="variable">t</span></a></span> <span class="inlinecode">:</span> <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> and <span class="inlinecode"><a class="idref" href="ImpParser.html#t"><span class="id" type="variable">t</span></a></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><a class="idref" href="Smallstep.html#t'"><span class="id" type="variable">t'</span></a></span>, then <span class="inlinecode"><a class="idref" href="RecordSub.html#empty"><span class="id" type="definition">empty</span></a></span> <span class="inlinecode">|-</span> <span class="inlinecode"><a class="idref" href="Smallstep.html#t'"><span class="id" type="variable">t'</span></a></span> <span class="inlinecode">:</span>
    <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span>.

<div class="paragraph"> </div>

    <i>Proof</i>: Let <span class="inlinecode"><a class="idref" href="ImpParser.html#t"><span class="id" type="variable">t</span></a></span> and <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> be given such that <span class="inlinecode"><a class="idref" href="RecordSub.html#empty"><span class="id" type="definition">empty</span></a></span> <span class="inlinecode">|-</span> <span class="inlinecode"><a class="idref" href="ImpParser.html#t"><span class="id" type="variable">t</span></a></span> <span class="inlinecode">:</span> <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span>.  We
    proceed by induction on the structure of this typing derivation,
    leaving <span class="inlinecode"><a class="idref" href="Smallstep.html#t'"><span class="id" type="variable">t'</span></a></span> general.  The cases <span class="inlinecode"><a class="idref" href="Norm.html#T_Abs"><span class="id" type="constructor">T_Abs</span></a></span>, <span class="inlinecode"><a class="idref" href="References.html#STLCRef.T_Unit"><span class="id" type="constructor">T_Unit</span></a></span>, <span class="inlinecode"><a class="idref" href="Norm.html#T_True"><span class="id" type="constructor">T_True</span></a></span>, and
    <span class="inlinecode"><a class="idref" href="Norm.html#T_False"><span class="id" type="constructor">T_False</span></a></span> cases are vacuous because abstractions and constants
    don't step.  Case <span class="inlinecode"><a class="idref" href="Norm.html#T_Var"><span class="id" type="constructor">T_Var</span></a></span> is vacuous as well, since the context is
    empty.

<div class="paragraph"> </div>

<ul class="doclist">
<li> If the final step of the derivation is by <span class="inlinecode"><a class="idref" href="Norm.html#T_App"><span class="id" type="constructor">T_App</span></a></span>, then there
       are terms <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> and <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span> and types <span class="inlinecode"><a class="idref" href="StlcProp.html#T1"><span class="id" type="variable">T1</span></a></span> and <span class="inlinecode"><a class="idref" href="StlcProp.html#T2"><span class="id" type="variable">T2</span></a></span> such that 
       <span class="inlinecode"><a class="idref" href="ImpParser.html#t"><span class="id" type="variable">t</span></a></span> <span class="inlinecode">=</span> <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span>, <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> <span class="inlinecode">=</span> <span class="inlinecode"><a class="idref" href="StlcProp.html#T2"><span class="id" type="variable">T2</span></a></span>, <span class="inlinecode"><a class="idref" href="RecordSub.html#empty"><span class="id" type="definition">empty</span></a></span> <span class="inlinecode">|-</span> <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> <span class="inlinecode">:</span> <span class="inlinecode"><a class="idref" href="StlcProp.html#T1"><span class="id" type="variable">T1</span></a></span> <span class="inlinecode">→</span> <span class="inlinecode"><a class="idref" href="StlcProp.html#T2"><span class="id" type="variable">T2</span></a></span>, and 
       <span class="inlinecode"><a class="idref" href="RecordSub.html#empty"><span class="id" type="definition">empty</span></a></span> <span class="inlinecode">|-</span> <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span> <span class="inlinecode">:</span> <span class="inlinecode"><a class="idref" href="StlcProp.html#T1"><span class="id" type="variable">T1</span></a></span>.

<div class="paragraph"> </div>

       By the definition of the step relation, there are three ways
       <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span> can step.  Cases <span class="inlinecode"><a class="idref" href="Norm.html#ST_App1"><span class="id" type="constructor">ST_App1</span></a></span> and <span class="inlinecode"><a class="idref" href="Norm.html#ST_App2"><span class="id" type="constructor">ST_App2</span></a></span> follow
       immediately by the induction hypotheses for the typing
       subderivations and a use of <span class="inlinecode"><a class="idref" href="Norm.html#T_App"><span class="id" type="constructor">T_App</span></a></span>.

<div class="paragraph"> </div>

       Suppose instead <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span> steps by <span class="inlinecode"><a class="idref" href="Norm.html#ST_AppAbs"><span class="id" type="constructor">ST_AppAbs</span></a></span>.  Then <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> <span class="inlinecode">=</span>
       <span class="inlinecode">\<a class="idref" href="RecordSub.html#Examples.x"><span class="id" type="abbreviation">x</span></a>:<span class="id" type="var">S.t12</span></span> for some type <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a></span> and term <span class="inlinecode"><a class="idref" href="Stlc.html#t12"><span class="id" type="variable">t12</span></a></span>, and <span class="inlinecode"><a class="idref" href="Smallstep.html#t'"><span class="id" type="variable">t'</span></a></span> <span class="inlinecode">=</span>
       <span class="inlinecode">[<a class="idref" href="RecordSub.html#Examples.x"><span class="id" type="abbreviation">x</span></a>:=<a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a>]<a class="idref" href="Stlc.html#t12"><span class="id" type="variable">t12</span></a></span>.

<div class="paragraph"> </div>

       By lemma <span class="inlinecode"><a class="idref" href="UseAuto.html#SubtypingInversion.abs_arrow"><span class="id" type="lemma">abs_arrow</span></a></span>, we have <span class="inlinecode"><a class="idref" href="StlcProp.html#T1"><span class="id" type="variable">T1</span></a></span> <span class="inlinecode">&lt;:</span> <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a></span> and <span class="inlinecode"><a class="idref" href="RecordSub.html#Examples.x"><span class="id" type="abbreviation">x</span></a>:<a class="idref" href="Sub.html#S1"><span class="id" type="variable">S1</span></a></span> <span class="inlinecode">|-</span> <span class="inlinecode"><a class="idref" href="Imp.html#s2"><span class="id" type="variable">s2</span></a></span> <span class="inlinecode">:</span> <span class="inlinecode"><a class="idref" href="StlcProp.html#T2"><span class="id" type="variable">T2</span></a></span>.
       It then follows by the substitution lemma 
       (<span class="inlinecode"><a class="idref" href="UseAuto.html#SubtypingInversion.substitution_preserves_typing"><span class="id" type="lemma">substitution_preserves_typing</span></a></span>) that <span class="inlinecode"><a class="idref" href="RecordSub.html#empty"><span class="id" type="definition">empty</span></a></span> <span class="inlinecode">|-</span> <span class="inlinecode">[<a class="idref" href="RecordSub.html#Examples.x"><span class="id" type="abbreviation">x</span></a>:=<a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a>]</span>
       <span class="inlinecode"><a class="idref" href="Stlc.html#t12"><span class="id" type="variable">t12</span></a></span> <span class="inlinecode">:</span> <span class="inlinecode"><a class="idref" href="StlcProp.html#T2"><span class="id" type="variable">T2</span></a></span> as desired.

<div class="paragraph"> </div>

<ul class="doclist">
<li> If the final step of the derivation uses rule <span class="inlinecode"><a class="idref" href="Norm.html#T_If"><span class="id" type="constructor">T_If</span></a></span>, then
        there are terms <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span>, <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span>, and <span class="inlinecode"><a class="idref" href="Smallstep.html#t3"><span class="id" type="variable">t3</span></a></span> such that <span class="inlinecode"><a class="idref" href="ImpParser.html#t"><span class="id" type="variable">t</span></a></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="keyword">if</span></span> <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> <span class="inlinecode"><span class="id" type="keyword">then</span></span>
        <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span> <span class="inlinecode"><span class="id" type="keyword">else</span></span> <span class="inlinecode"><a class="idref" href="Smallstep.html#t3"><span class="id" type="variable">t3</span></a></span>, with <span class="inlinecode"><a class="idref" href="RecordSub.html#empty"><span class="id" type="definition">empty</span></a></span> <span class="inlinecode">|-</span> <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="library">Bool</span></span> and with <span class="inlinecode"><a class="idref" href="RecordSub.html#empty"><span class="id" type="definition">empty</span></a></span> <span class="inlinecode">|-</span> <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span> <span class="inlinecode">:</span>
        <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> and <span class="inlinecode"><a class="idref" href="RecordSub.html#empty"><span class="id" type="definition">empty</span></a></span> <span class="inlinecode">|-</span> <span class="inlinecode"><a class="idref" href="Smallstep.html#t3"><span class="id" type="variable">t3</span></a></span> <span class="inlinecode">:</span> <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span>.  Moreover, by the induction
        hypothesis, if <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> steps to <span class="inlinecode"><a class="idref" href="Smallstep.html#t1'"><span class="id" type="variable">t1'</span></a></span> then <span class="inlinecode"><a class="idref" href="RecordSub.html#empty"><span class="id" type="definition">empty</span></a></span> <span class="inlinecode">|-</span> <span class="inlinecode"><a class="idref" href="Smallstep.html#t1'"><span class="id" type="variable">t1'</span></a></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="library">Bool</span></span>.
        There are three cases to consider, depending on which rule was
        used to show <span class="inlinecode"><a class="idref" href="ImpParser.html#t"><span class="id" type="variable">t</span></a></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><a class="idref" href="Smallstep.html#t'"><span class="id" type="variable">t'</span></a></span>.

<div class="paragraph"> </div>

<ul class="doclist">
<li> If <span class="inlinecode"><a class="idref" href="ImpParser.html#t"><span class="id" type="variable">t</span></a></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><a class="idref" href="Smallstep.html#t'"><span class="id" type="variable">t'</span></a></span> by rule <span class="inlinecode"><a class="idref" href="Norm.html#ST_If"><span class="id" type="constructor">ST_If</span></a></span>, then <span class="inlinecode"><a class="idref" href="Smallstep.html#t'"><span class="id" type="variable">t'</span></a></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="keyword">if</span></span> <span class="inlinecode"><a class="idref" href="Smallstep.html#t1'"><span class="id" type="variable">t1'</span></a></span> <span class="inlinecode"><span class="id" type="keyword">then</span></span> <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span>
             <span class="inlinecode"><span class="id" type="keyword">else</span></span> <span class="inlinecode"><a class="idref" href="Smallstep.html#t3"><span class="id" type="variable">t3</span></a></span> with <span class="inlinecode"><a class="idref" href="SfLib.html#t1"><span class="id" type="variable">t1</span></a></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><a class="idref" href="Smallstep.html#t1'"><span class="id" type="variable">t1'</span></a></span>.  By the induction hypothesis,
             <span class="inlinecode"><a class="idref" href="RecordSub.html#empty"><span class="id" type="definition">empty</span></a></span> <span class="inlinecode">|-</span> <span class="inlinecode"><a class="idref" href="Smallstep.html#t1'"><span class="id" type="variable">t1'</span></a></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="library">Bool</span></span>, and so <span class="inlinecode"><a class="idref" href="RecordSub.html#empty"><span class="id" type="definition">empty</span></a></span> <span class="inlinecode">|-</span> <span class="inlinecode"><a class="idref" href="Smallstep.html#t'"><span class="id" type="variable">t'</span></a></span> <span class="inlinecode">:</span> <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> by <span class="inlinecode"><a class="idref" href="Norm.html#T_If"><span class="id" type="constructor">T_If</span></a></span>.

<div class="paragraph"> </div>


</li>
<li> If <span class="inlinecode"><a class="idref" href="ImpParser.html#t"><span class="id" type="variable">t</span></a></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><a class="idref" href="Smallstep.html#t'"><span class="id" type="variable">t'</span></a></span> by rule <span class="inlinecode"><a class="idref" href="Norm.html#ST_IfTrue"><span class="id" type="constructor">ST_IfTrue</span></a></span> or <span class="inlinecode"><a class="idref" href="Norm.html#ST_IfFalse"><span class="id" type="constructor">ST_IfFalse</span></a></span>, then
             either <span class="inlinecode"><a class="idref" href="Smallstep.html#t'"><span class="id" type="variable">t'</span></a></span> <span class="inlinecode">=</span> <span class="inlinecode"><a class="idref" href="SfLib.html#t2"><span class="id" type="variable">t2</span></a></span> or <span class="inlinecode"><a class="idref" href="Smallstep.html#t'"><span class="id" type="variable">t'</span></a></span> <span class="inlinecode">=</span> <span class="inlinecode"><a class="idref" href="Smallstep.html#t3"><span class="id" type="variable">t3</span></a></span>, and <span class="inlinecode"><a class="idref" href="RecordSub.html#empty"><span class="id" type="definition">empty</span></a></span> <span class="inlinecode">|-</span> <span class="inlinecode"><a class="idref" href="Smallstep.html#t'"><span class="id" type="variable">t'</span></a></span> <span class="inlinecode">:</span> <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span>
             follows by assumption.

<div class="paragraph"> </div>


</li>
</ul>

</li>
</ul>

</li>
<li> If the final step of the derivation is by <span class="inlinecode"><a class="idref" href="RecordSub.html#T_Sub"><span class="id" type="constructor">T_Sub</span></a></span>, then there
       is a type <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a></span> such that <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a></span> <span class="inlinecode">&lt;:</span> <span class="inlinecode"><a class="idref" href="Basics.html#T"><span class="id" type="variable">T</span></a></span> and <span class="inlinecode"><a class="idref" href="RecordSub.html#empty"><span class="id" type="definition">empty</span></a></span> <span class="inlinecode">|-</span> <span class="inlinecode"><a class="idref" href="ImpParser.html#t"><span class="id" type="variable">t</span></a></span> <span class="inlinecode">:</span> <span class="inlinecode"><a class="idref" href="Basics.html#Playground1.S"><span class="id" type="constructor">S</span></a></span>.  The
       result is immediate by the induction hypothesis for the typing
       subderivation and an application of <span class="inlinecode"><a class="idref" href="RecordSub.html#T_Sub"><span class="id" type="constructor">T_Sub</span></a></span>.  <font size=-2>&#9744;</font> 
</li>
</ul>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Theorem</span> <a name="preservation"><span class="id" type="lemma">preservation</span></a> : <span class="id" type="keyword">∀</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span class="id" type="var">T</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#empty"><span class="id" type="definition">empty</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#t"><span class="id" type="variable">t</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a>  →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#t"><span class="id" type="variable">t</span></a> <a class="idref" href="Sub.html#::x_'==>'_x"><span class="id" type="notation">==&gt;</span></a> <a class="idref" href="Sub.html#t'"><span class="id" type="variable">t'</span></a>  →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sub.html#empty"><span class="id" type="definition">empty</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">|-</span></a> <a class="idref" href="Sub.html#t'"><span class="id" type="variable">t'</span></a> <a class="idref" href="Sub.html#::x_'|-'_x_'\in'_x"><span class="id" type="notation">\</span></a><span class="id" type="keyword">in</span> <a class="idref" href="Sub.html#T"><span class="id" type="variable">T</span></a>.<br/>
<span class="id" type="keyword">Proof</span> <span class="id" type="keyword">with</span> <span class="id" type="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span class="id" type="var">T</span> <span class="id" type="var">HT</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">remember</span> <a class="idref" href="Sub.html#empty"><span class="id" type="definition">empty</span></a> <span class="id" type="keyword">as</span> <span class="id" type="var">Gamma</span>. <span class="id" type="tactic">generalize</span> <span class="id" type="tactic">dependent</span> <span class="id" type="var">HeqGamma</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">generalize</span> <span class="id" type="tactic">dependent</span> <span class="id" type="var">t'</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">has_type_cases</span> (<span class="id" type="tactic">induction</span> <span class="id" type="var">HT</span>) <span class="id" type="var">Case</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">t'</span> <span class="id" type="var">HeqGamma</span> <span class="id" type="var">HE</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">HE</span>; <span class="id" type="tactic">subst</span>...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_App".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">HE</span>; <span class="id" type="tactic">subst</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "ST_AppAbs".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<a class="idref" href="Sub.html#abs_arrow"><span class="id" type="lemma">abs_arrow</span></a> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">HT1</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">HA1</span> <span class="id" type="var">HA2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="Sub.html#substitution_preserves_typing"><span class="id" type="lemma">substitution_preserves_typing</span></a> <span class="id" type="keyword">with</span> <span class="id" type="var">T</span>...<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab818"></a><h2 class="section">Records, via Products and Top</h2>

<div class="paragraph"> </div>

 This formalization of the STLC with subtyping has omitted record
    types, for brevity.  If we want to deal with them more seriously,
    we have two choices.  

<div class="paragraph"> </div>

    First, we can treat them as part of the core language, writing
    down proper syntax, typing, and subtyping rules for them.  Chapter
    <span class="inlinecode"><span class="id" type="library">RecordSub</span></span> shows how this extension works.

<div class="paragraph"> </div>

    On the other hand, if we are treating them as a derived form that
    is desugared in the parser, then we shouldn't need any new rules:
    we should just check that the existing rules for subtyping product
    and <span class="inlinecode"><span class="id" type="var">Unit</span></span> types give rise to reasonable rules for record
    subtyping via this encoding. To do this, we just need to make one
    small change to the encoding described earlier: instead of using
    <span class="inlinecode"><span class="id" type="var">Unit</span></span> as the base case in the encoding of tuples and the "don't
    care" placeholder in the encoding of records, we use <span class="inlinecode"><span class="id" type="var">Top</span></span>.  So:
<pre>
    {a:Nat, b:Nat} ----&gt; {Nat,Nat}       i.e. (Nat,(Nat,Top))
    {c:Nat, a:Nat} ----&gt; {Nat,Top,Nat}   i.e. (Nat,(Top,(Nat,Top)))
</pre>
    The encoding of record values doesn't change at all.  It is
    easy (and instructive) to check that the subtyping rules above are
    validated by the encoding.  For the rest of this chapter, we'll
    follow this encoding-based approach. 
</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a name="lab819"></a><h2 class="section">Exercises</h2>

<div class="paragraph"> </div>

<a name="lab820"></a><h4 class="section">Exercise: 2 stars (variations)</h4>
 Each part of this problem suggests a different way of
    changing the definition of the STLC with Unit and
    subtyping.  (These changes are not cumulative: each part
    starts from the original language.)  In each part, list which
    properties (Progress, Preservation, both, or neither) become
    false.  If a property becomes false, give a counterexample.

<div class="paragraph"> </div>

<ul class="doclist">
<li> Suppose we add the following typing rule:
                            Gamma |- t : S1-&gt;S2
                    S1 &lt;: T1      T1 &lt;: S1     S2 &lt;: T2
<ul class="doclist">
<li>----------------------------------              (T_Funny1)
                            Gamma |- t : T1-&gt;T2

<div class="paragraph"> </div>


</li>
</ul>

</li>
<li> Suppose we add the following reduction rule:
<ul class="doclist">
<li>-----------------                     (ST_Funny21)

</li>
</ul>
                             unit ==&gt; (\x:Top. x)

<div class="paragraph"> </div>


</li>
<li> Suppose we add the following subtyping rule:
<ul class="doclist">
<li>-------------                        (S_Funny3)

</li>
</ul>
                               Unit &lt;: Top-&gt;Top

<div class="paragraph"> </div>


</li>
<li> Suppose we add the following subtyping rule:
<ul class="doclist">
<li>-------------                        (S_Funny4)

</li>
</ul>
                               Top-&gt;Top &lt;: Unit

<div class="paragraph"> </div>


</li>
<li> Suppose we add the following evaluation rule:
<ul class="doclist">
<li>----------------                      (ST_Funny5)

</li>
</ul>
                             (unit t) ==&gt; (t unit)

<div class="paragraph"> </div>


</li>
<li> Suppose we add the same evaluation rule <i>and</i> a new typing rule:
<ul class="doclist">
<li>----------------                      (ST_Funny5)

</li>
</ul>
                             (unit t) ==&gt; (t unit)

<div class="paragraph"> </div>

<ul class="doclist">
<li>---------------------                    (T_Funny6)

</li>
</ul>
                           empty |- Unit : Top-&gt;Top

<div class="paragraph"> </div>


</li>
<li> Suppose we <i>change</i> the arrow subtyping rule to:
                          S1 &lt;: T1       S2 &lt;: T2
<ul class="doclist">
<li>----------------------                    (S_Arrow')
                               S1-&gt;S2 &lt;: T1-&gt;T2

</li>
</ul>

</li>
</ul>

<div class="paragraph"> </div>

<font size=-2>&#9744;</font> 
</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a name="lab821"></a><h1 class="section">Exercise: Adding Products</h1>

<div class="paragraph"> </div>

<a name="lab822"></a><h4 class="section">Exercise: 4 stars (products)</h4>
 Adding pairs, projections, and product types to the system we have
    defined is a relatively straightforward matter.  Carry out this
    extension:

<div class="paragraph"> </div>

<ul class="doclist">
<li> Add constructors for pairs, first and second projections, and
      product types to the definitions of <span class="inlinecode"><a class="idref" href="Norm.html#ty"><span class="id" type="inductive">ty</span></a></span> and <span class="inlinecode"><a class="idref" href="Norm.html#tm"><span class="id" type="inductive">tm</span></a></span>.  (Don't
      forget to add corresponding cases to <span class="inlinecode"><span class="id" type="var">T_cases</span></span> and <span class="inlinecode"><span class="id" type="var">t_cases</span></span>.)

<div class="paragraph"> </div>


</li>
<li> Extend the substitution function and value relation as in 
      MoreSTLC.

<div class="paragraph"> </div>


</li>
<li> Extend the operational semantics with the same reduction rules
      as in MoreSTLC.

<div class="paragraph"> </div>


</li>
<li> Extend the subtyping relation with this rule:

<div class="paragraph"> </div>

                        S1 &lt;: T1     S2 &lt;: T2
<ul class="doclist">
<li>--------------------                     (Sub_Prod)
                          S1 * S2 &lt;: T1 * T2

<div class="paragraph"> </div>


</li>
</ul>

</li>
<li> Extend the typing relation with the same rules for pairs and
      projections as in MoreSTLC.

<div class="paragraph"> </div>


</li>
<li> Extend the proofs of progress, preservation, and all their
      supporting lemmas to deal with the new constructs.  (You'll also
      need to add some completely new lemmas.)  

</li>
</ul>
<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

  
</div>
<div class="code">

<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>